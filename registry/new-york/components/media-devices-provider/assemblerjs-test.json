{
  "$schema": "https://shadcn-vue.com/schema/registry-item.json",
  "install": "https://benoitlahoz.github.io/assembler-ui/r/media-devices-provider.json",
  "name": "media-devices-provider",
  "title": "MediaDevicesProvider",
  "description": "A renderless provider component that supplies media devices information and handles permissions.\n\nThis component uses the MediaDevices API to list available audio and video input devices.\nIt manages user permissions and provides reactive access to device information.\n\nThe demos below use different MediaDevicesProvider. In real world usage, you would typically wrap your application or a section of it with the MediaDevicesProvider component.",
  "category": "devices",
  "type": "registry:ui",
  "dependencies": {
    "dependsOn": [
      {
        "path": "composables/use-media-devices",
        "name": "use-media-devices"
      }
    ],
    "usedBy": []
  },
  "demo": [
    {
      "name": "media-devices-provider-demo-simple",
      "html": "<script setup lang=\"ts\">\nimport { ref } from 'vue';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { MediaDevicesProvider } from '@/components/ui/media-devices-provider';\n\nconst open = ref(false);\n</script>\n<template>\n  <div class=\"h-128 max-h-128 overflow-hidden flex flex-col\">\n    <Button :disabled=\"open\" class=\"m-4 mb-2\" @click=\"open = true\">Open Devices</Button>\n    <MediaDevicesProvider :open=\"open\" v-slot=\"{ devices, errors }\">\n      <div class=\"overflow-y-auto flex-1 min-h-0 select-none m-4 rounded border border-muted\">\n        <table class=\"w-full\">\n          <thead\n            class=\"sticky top-0 bg-default z-10 after:content-[''] after:absolute after:bottom-0 after:left-0 after:right-0 after:h-px after:bg-border\"\n          >\n            <tr class=\"text-sm\">\n              <th class=\"text-left py-2 bg-default w-32 pl-4\">Type</th>\n              <th class=\"text-left py-2 bg-default\">Label</th>\n              <th class=\"text-left py-2 bg-default\">Device ID</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr\n              v-for=\"device in devices\"\n              :key=\"device.deviceId\"\n              class=\"border-b border-muted hover:bg-accent\"\n            >\n              <td class=\"py-2 w-32 pl-4\">\n                <Badge\n                  :variant=\"\n                    device.kind === 'videoinput'\n                      ? 'default'\n                      : device.kind === 'audioinput'\n                        ? 'secondary'\n                        : 'destructive'\n                  \"\n                >\n                  {{ device.kind }}\n                </Badge>\n              </td>\n              <td class=\"py-2 text-sm\">{{ device.label || 'Without label' }}</td>\n              <td class=\"py-2 font-mono text-xs text-gray-500\">\n                {{ device.deviceId.substring(0, 20) }}...\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n      <div\n        v-if=\"errors && errors.length > 0\"\n        class=\"mt-4 mx-4 p-4 rounded border border-destructive bg-destructive/10 text-destructive mb-4\"\n      >\n        <p class=\"font-bold\">Errors:</p>\n        <ul>\n          <li v-for=\"(error, index) in errors\" :key=\"index\" class=\"text-sm\">{{ error }}</li>\n        </ul>\n      </div>\n    </MediaDevicesProvider>\n  </div>\n</template>\n",
      "pug": "<script setup lang=\"ts\">\nimport { ref } from 'vue';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { MediaDevicesProvider } from '@/components/ui/media-devices-provider';\n\nconst open = ref(false);\n</script>\n<template lang=\"pug\">\ndiv(class=\"h-128 max-h-128 overflow-hidden flex flex-col\")\n  Button(:disabled=\"open\" class=\"m-4 mb-2\" @click=\"open = true\")\n    | Open Devices\n  MediaDevicesProvider(:open=\"open\" v-slot=\"{ devices, errors }\")\n    div(class=\"overflow-y-auto flex-1 min-h-0 select-none m-4 rounded border border-muted\")\n      table(class=\"w-full\")\n        thead(class=\"sticky top-0 bg-default z-10 after:content-[''] after:absolute after:bottom-0 after:left-0 after:right-0 after:h-px after:bg-border\")\n          tr(class=\"text-sm\")\n            th(class=\"text-left py-2 bg-default w-32 pl-4\")\n              | Type\n            th(class=\"text-left py-2 bg-default\")\n              | Label\n            th(class=\"text-left py-2 bg-default\")\n              | Device ID\n        tbody\n          tr(v-for=\"device in devices\" :key=\"device.deviceId\" class=\"border-b border-muted hover:bg-accent\")\n            td(class=\"py-2 w-32 pl-4\")\n              Badge(:variant=\" device.kind === 'videoinput' ? 'default' : device.kind === 'audioinput' ? 'secondary' : 'destructive' \")\n                | {{ device.kind }}\n            td(class=\"py-2 text-sm\")\n              | {{ device.label || 'Without label' }}\n            td(class=\"py-2 font-mono text-xs text-gray-500\")\n              | {{ device.deviceId.substring(0, 20) }}...\n    div(v-if=\"errors && errors.length)\n      | 0\"\n      | class=\"mt-4 mx-4 p-4 rounded border border-destructive bg-destructive/10 text-destructive mb-4\"\n      | >\n      p(class=\"font-bold\")\n        | Errors:\n      ul\n        li(v-for=\"(error, index) in errors\" :key=\"index\" class=\"text-sm\")\n          | {{ error }}\n</template>\n"
    },
    {
      "name": "media-device-demo-simple",
      "definition": [
        "Stream Cache",
        "Select a camera from the list. The provider caches streams to avoid reopening the same device."
      ],
      "html": "<script setup lang=\"ts\">\n/**\n * Simple demo of MediaDevice component with MediaDevicesProvider for stream caching.\n */\nimport { ref, watch } from 'vue';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Label } from '@/components/ui/label';\nimport {\n  MediaDevicesProvider,\n  VideoDevice,\n} from '@/components/ui/media-devices-provider';\n\nconst videoRef = ref<HTMLVideoElement | null>(null);\nconst selectedDeviceId = ref<string>('');\n\nconst handleStream = (stream: MediaStream | null) => {\n  if (videoRef.value && stream) {\n    videoRef.value.srcObject = stream;\n  } else if (videoRef.value && !stream) {\n    videoRef.value.srcObject = null;\n  }\n};\n\nconst selectDevice = (deviceId: string) => {\n  selectedDeviceId.value = deviceId;\n};\n\n// Watch for changes to ensure video element is updated when switching devices\nwatch([videoRef, selectedDeviceId], async () => {\n  // Reset video element when changing devices\n  if (videoRef.value) {\n    videoRef.value.srcObject = null;\n  }\n});\n</script>\n\n<template>\n  <div class=\"space-y-4\">\n    <MediaDevicesProvider :open=\"true\">\n      <template #default=\"{ devices, errors, cachedStreamsCount }\">\n        <div class=\"space-y-4\">\n          <!-- Device selector -->\n          <div class=\"space-y-2\">\n            <Label class=\"text-sm font-bold mb-4\">Available Cameras</Label>\n            <div class=\"grid gap-2\">\n              <Button\n                v-for=\"device in devices.filter((d) => d.kind === 'videoinput')\"\n                :key=\"device.deviceId\"\n                @click=\"selectDevice(device.deviceId)\"\n                :variant=\"selectedDeviceId === device.deviceId ? 'default' : 'outline'\"\n                size=\"sm\"\n                class=\"justify-start\"\n              >\n                <Badge v-if=\"selectedDeviceId === device.deviceId\" class=\"mr-2\" variant=\"secondary\">\n                  Active\n                </Badge>\n                {{ device.label || 'Camera' }}\n              </Button>\n            </div>\n          </div>\n\n          <!-- VideoDevice with selected camera -->\n          <VideoDevice\n            v-if=\"selectedDeviceId\"\n            :device-id=\"selectedDeviceId\"\n            :width=\"1280\"\n            :height=\"720\"\n            :frame-rate=\"30\"\n            auto-start\n            @stream=\"handleStream\"\n          >\n            <template #default=\"{ stream, isActive, error, start, stop }\">\n              <div class=\"space-y-4\">\n                <!-- Video preview -->\n                <div\n                  class=\"relative bg-black rounded-lg overflow-hidden\"\n                  style=\"aspect-ratio: 16/9\"\n                >\n                  <video\n                    ref=\"videoRef\"\n                    autoplay\n                    playsinline\n                    muted\n                    class=\"w-full h-full object-cover\"\n                  />\n                  <div\n                    v-if=\"!isActive\"\n                    class=\"absolute inset-0 flex items-center justify-center bg-muted/50\"\n                  >\n                    <p class=\"text-muted-foreground\">Camera not started</p>\n                  </div>\n                  <!-- Device info overlay -->\n                  <div\n                    v-if=\"isActive\"\n                    class=\"absolute top-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-xs\"\n                  >\n                    {{ devices.find((d) => d.deviceId === selectedDeviceId)?.label || 'Camera' }}\n                  </div>\n                </div>\n\n                <!-- Controls -->\n                <div class=\"flex gap-2\">\n                  <Button @click=\"start\" :disabled=\"isActive\"> Start Camera </Button>\n                  <Button @click=\"stop\" :disabled=\"!isActive\" variant=\"destructive\">\n                    Stop Camera\n                  </Button>\n                </div>\n\n                <!-- Status -->\n                <div class=\"text-sm space-y-1\">\n                  <p>\n                    Status:\n                    <span :class=\"isActive ? 'text-green-600' : 'text-gray-500'\">\n                      {{ isActive ? 'Active' : 'Inactive' }}\n                    </span>\n                  </p>\n                  <p v-if=\"stream\" class=\"text-xs text-muted-foreground\">\n                    Tracks: {{ stream.getTracks().length }} | Device ID:\n                    {{ selectedDeviceId.substring(0, 20) }}...\n                  </p>\n                  <p class=\"text-xs text-muted-foreground\">\n                    Cached streams: {{ cachedStreamsCount }}\n                  </p>\n                </div>\n\n                <!-- Error -->\n                <div\n                  v-if=\"error\"\n                  class=\"p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm\"\n                >\n                  <p class=\"font-medium\">Error:</p>\n                  <p>\n                    {{ error.message || error }}\n                    {{ (error as any).constraint ? `(${(error as any).constraint})` : '' }}\n                  </p>\n                </div>\n              </div>\n            </template>\n          </VideoDevice>\n\n          <!-- No device selected -->\n          <div\n            v-else\n            class=\"border-2 border-dashed rounded-lg p-8 text-center text-muted-foreground\"\n          >\n            <p>Select a camera from the list above to start</p>\n          </div>\n\n          <!-- Provider errors -->\n          <div\n            v-if=\"errors && errors.length > 0\"\n            class=\"p-4 rounded border border-destructive bg-destructive/10 text-destructive\"\n          >\n            <p class=\"font-bold\">Provider Errors:</p>\n            <ul class=\"text-sm space-y-1 mt-2\">\n              <li v-for=\"(error, index) in errors\" :key=\"index\">\n                {{ error.message || error }}\n                {{ (error as any).constraint ? `(${(error as any).constraint})` : '' }}\n              </li>\n            </ul>\n          </div>\n        </div>\n      </template>\n    </MediaDevicesProvider>\n  </div>\n</template>\n",
      "pug": "<script setup lang=\"ts\">\n/**\n * Simple demo of MediaDevice component with MediaDevicesProvider for stream caching.\n */\nimport { ref, watch } from 'vue';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Label } from '@/components/ui/label';\nimport {\n  MediaDevicesProvider,\n  VideoDevice,\n} from '@/components/ui/media-devices-provider';\n\nconst videoRef = ref<HTMLVideoElement | null>(null);\nconst selectedDeviceId = ref<string>('');\n\nconst handleStream = (stream: MediaStream | null) => {\n  if (videoRef.value && stream) {\n    videoRef.value.srcObject = stream;\n  } else if (videoRef.value && !stream) {\n    videoRef.value.srcObject = null;\n  }\n};\n\nconst selectDevice = (deviceId: string) => {\n  selectedDeviceId.value = deviceId;\n};\n\n// Watch for changes to ensure video element is updated when switching devices\nwatch([videoRef, selectedDeviceId], async () => {\n  // Reset video element when changing devices\n  if (videoRef.value) {\n    videoRef.value.srcObject = null;\n  }\n});\n</script>\n\n<template lang=\"pug\">\n<!-- Device selector -->\n<!-- VideoDevice with selected camera -->\n<!-- Video preview -->\n<!-- Device info overlay -->\n<!-- Controls -->\n<!-- Status -->\n<!-- Error -->\ndiv(class=\"space-y-4\")\n  MediaDevicesProvider(:open=\"true\")\n    template(#default=\"{ devices, errors, cachedStreamsCount }\")\n      div(class=\"space-y-4\")\n        div(class=\"space-y-2\")\n          Label(class=\"text-sm font-bold mb-4\")\n            | Available Cameras\n          div(class=\"grid gap-2\")\n            Button(v-for=\"device in devices.filter((d) =)\n              | d.kind === 'videoinput')\"\n              | :key=\"device.deviceId\"\n              | @click=\"selectDevice(device.deviceId)\"\n              | :variant=\"selectedDeviceId === device.deviceId ? 'default' : 'outline'\"\n              | size=\"sm\"\n              | class=\"justify-start\"\n              | >\n              Badge(v-if=\"selectedDeviceId === device.deviceId\" class=\"mr-2\" variant=\"secondary\")\n                | Active\n              | {{ device.label || 'Camera' }}\n        VideoDevice(v-if=\"selectedDeviceId\" :device-id=\"selectedDeviceId\" :width=\"1280\" :height=\"720\" :frame-rate=\"30\" auto-start @stream=\"handleStream\")\n          template(#default=\"{ stream, isActive, error, start, stop }\")\n            div(class=\"space-y-4\")\n              div(class=\"relative bg-black rounded-lg overflow-hidden\" style=\"aspect-ratio: 16/9\")\n                video(ref=\"videoRef\" autoplay playsinline muted class=\"w-full h-full object-cover\")\n                div(v-if=\"!isActive\" class=\"absolute inset-0 flex items-center justify-center bg-muted/50\")\n                  p(class=\"text-muted-foreground\")\n                    | Camera not started\n                div(v-if=\"isActive\" class=\"absolute top-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-xs\")\n                  | {{ devices.find((d) => d.deviceId === selectedDeviceId)?.label || 'Camera' }}\n              div(class=\"flex gap-2\")\n                Button(@click=\"start\" :disabled=\"isActive\")\n                  | Start Camera\n                Button(@click=\"stop\" :disabled=\"!isActive\" variant=\"destructive\")\n                  | Stop Camera\n              div(class=\"text-sm space-y-1\")\n                p\n                  | Status:\n                  span(:class=\"isActive ? 'text-green-600' : 'text-gray-500'\")\n                    | {{ isActive ? 'Active' : 'Inactive' }}\n                p(v-if=\"stream\" class=\"text-xs text-muted-foreground\")\n                  | Tracks: {{ stream.getTracks().length }} | Device ID:\n                  | {{ selectedDeviceId.substring(0, 20) }}...\n                p(class=\"text-xs text-muted-foreground\")\n                  | Cached streams: {{ cachedStreamsCount }}\n              div(v-if=\"error\" class=\"p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm\")\n                p(class=\"font-medium\")\n                  | Error:\n                p\n                  | {{ error.message || error }}\n                  | {{ (error as any).constraint ? `(${(error as any).constraint})` : '' }}\n</template>\n          </VideoDevice>\n\n          <!-- No device selected -->\n          <div\n            v-else\n            class=\"border-2 border-dashed rounded-lg p-8 text-center text-muted-foreground\"\n          >\n            <p>Select a camera from the list above to start</p>\n          </div>\n\n          <!-- Provider errors -->\n          <div\n            v-if=\"errors && errors.length > 0\"\n            class=\"p-4 rounded border border-destructive bg-destructive/10 text-destructive\"\n          >\n            <p class=\"font-bold\">Provider Errors:</p>\n            <ul class=\"text-sm space-y-1 mt-2\">\n              <li v-for=\"(error, index) in errors\" :key=\"index\">\n                {{ error.message || error }}\n                {{ (error as any).constraint ? `(${(error as any).constraint})` : '' }}\n              </li>\n            </ul>\n          </div>\n        </div>\n      </template>\n    </MediaDevicesProvider>\n  </div>\n</template>\n"
    },
    {
      "name": "media-device-demo-presets",
      "definition": [
        "Presets",
        "Select a camera and quality preset. The provider caches streams efficiently when switching presets."
      ],
      "html": "<script setup lang=\"ts\">\n/**\n * Demo showing VideoDevice with MediaDevicesProvider and different constraint presets.\n * Demonstrates stream caching when switching between presets on the same device.\n */\nimport { ref, computed } from 'vue';\nimport { toPascalCase } from '@assemblerjs/core';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Label } from '@/components/ui/label';\nimport {\n  MediaDevicesProvider,\n  VideoDevice,\n  VideoPresets,\n} from '@/components/ui/media-devices-provider';\n\ntype PresetName = keyof typeof VideoPresets;\n\nconst selectedPreset = ref<PresetName>('hd');\nconst selectedDeviceId = ref<string>('');\nconst videoRef = ref<HTMLVideoElement | null>(null);\nconst currentStream = ref<MediaStream | null>(null);\n\n// Detect if we're on a mobile device\nconst isMobile = computed(() => {\n  if (typeof navigator === 'undefined') return false;\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n});\n\n// Filter presets based on device type\nconst availablePresets = computed(() => {\n  const presets = { ...VideoPresets };\n  // Remove mobile presets on desktop\n  if (!isMobile.value) {\n    delete (presets as any).mobileFront;\n    delete (presets as any).mobileBack;\n  }\n  return presets;\n});\n\nconst currentPreset = computed(() => VideoPresets[selectedPreset.value]);\n\nconst handleStream = (stream: MediaStream | null) => {\n  currentStream.value = stream;\n  if (videoRef.value) {\n    videoRef.value.srcObject = stream;\n  }\n};\n\nconst selectDevice = (deviceId: string) => {\n  selectedDeviceId.value = deviceId;\n};\n\nconst getActualResolution = () => {\n  if (!videoRef.value || !currentStream.value) return null;\n  const videoTrack = currentStream.value.getVideoTracks()[0];\n  if (!videoTrack) return null;\n  const settings = videoTrack.getSettings();\n  return {\n    width: settings.width,\n    height: settings.height,\n    frameRate: settings.frameRate,\n  };\n};\n\nconst formatPresetName = (name: string): string => {\n  // List of standard preset names that should not be formatted\n  const standardNames: Record<string, string> = {\n    sd: 'SD',\n    hd: 'HD',\n    fullhd: 'Full HD',\n    '4k': '4K',\n    uhd: 'UHD',\n    uhd4k: 'UHD 4K',\n    qhd: 'QHD',\n    vga: 'VGA',\n    qvga: 'QVGA',\n  };\n\n  const lowerName = name.toLowerCase();\n\n  // Return standard name if it exists\n  if (standardNames[lowerName]) {\n    return standardNames[lowerName];\n  }\n\n  // Otherwise, convert to Pascal Case with spaces for non-standard names\n  // but ensure 'hd' is always in uppercase\n  let formatted = toPascalCase(name)\n    .replace(/([A-Z])/g, ' $1')\n    .trim();\n\n  // Replace any occurrence of 'Hd' with 'HD' (case-insensitive)\n  formatted = formatted.replace(/\\bHd\\b/gi, 'HD');\n\n  return formatted;\n};\n</script>\n\n<template>\n  <div class=\"flex flex-col\">\n    <MediaDevicesProvider :open=\"true\">\n      <template #default=\"{ devices, errors }\">\n        <div class=\"flex flex-col h-full overflow-hidden\">\n          <!-- Top controls section -->\n          <div class=\"p-4 space-y-4\">\n            <!-- Device selector -->\n            <div class=\"space-y-2\">\n              <Label class=\"text-sm font-bold mb-4\">Available Cameras</Label>\n              <div class=\"grid gap-2\">\n                <Button\n                  v-for=\"device in devices.filter((d) => d.kind === 'videoinput')\"\n                  :key=\"device.deviceId\"\n                  @click=\"selectDevice(device.deviceId)\"\n                  :variant=\"selectedDeviceId === device.deviceId ? 'default' : 'outline'\"\n                  size=\"sm\"\n                  class=\"justify-start\"\n                >\n                  <Badge\n                    v-if=\"selectedDeviceId === device.deviceId\"\n                    class=\"mr-2\"\n                    variant=\"secondary\"\n                  >\n                    Active\n                  </Badge>\n                  {{ device.label || 'Camera' }}\n                </Button>\n              </div>\n            </div>\n\n            <!-- Preset selector -->\n            <div class=\"space-y-2\">\n              <Label class=\"text-sm font-bold mb-4\">Video Quality</Label>\n              <div class=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n                <Button\n                  v-for=\"(preset, name) in availablePresets\"\n                  :key=\"name\"\n                  @click=\"selectedPreset = name as PresetName\"\n                  :variant=\"selectedPreset === name ? 'default' : 'outline'\"\n                  size=\"sm\"\n                >\n                  {{ formatPresetName(name as string) }}\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          <!-- Main content area - scrollable -->\n          <div class=\"flex-1 overflow-y-auto min-h-0\">\n            <!-- VideoDevice with selected preset and device -->\n            <VideoDevice\n              v-if=\"selectedDeviceId\"\n              :device-id=\"selectedDeviceId\"\n              v-bind=\"currentPreset\"\n              auto-start\n              @stream=\"handleStream\"\n            >\n              <template #default=\"{ stream, isActive, error, start, stop }\">\n                <div class=\"p-4 space-y-4\">\n                  <!-- Video preview -->\n                  <div\n                    class=\"relative bg-black rounded-lg overflow-hidden border border-muted\"\n                    style=\"aspect-ratio: 16/9\"\n                  >\n                    <video\n                      ref=\"videoRef\"\n                      autoplay\n                      playsinline\n                      muted\n                      class=\"w-full h-full object-cover\"\n                    />\n                    <div\n                      v-if=\"!isActive\"\n                      class=\"absolute inset-0 flex items-center justify-center bg-muted/50\"\n                    >\n                      <p class=\"text-muted-foreground\">Camera not started</p>\n                    </div>\n                    <!-- Resolution overlay -->\n                    <div\n                      v-if=\"isActive\"\n                      class=\"absolute top-2 left-2 space-y-1 bg-black/70 text-white px-2 py-1 rounded text-xs font-mono\"\n                    >\n                      <div>{{ formatPresetName(selectedPreset) }}</div>\n                      <div v-if=\"getActualResolution()\">\n                        {{ getActualResolution()?.width }}x{{ getActualResolution()?.height }} @\n                        {{ getActualResolution()?.frameRate?.toFixed(0) }}fps\n                      </div>\n                    </div>\n                  </div>\n\n                  <!-- Controls -->\n                  <div class=\"flex gap-2\">\n                    <Button @click=\"start\" :disabled=\"isActive\"> Start Camera </Button>\n                    <Button @click=\"stop\" :disabled=\"!isActive\" variant=\"destructive\">\n                      Stop Camera\n                    </Button>\n                  </div>\n\n                  <!-- Info panels -->\n                  <div class=\"grid md:grid-cols-2 gap-4\">\n                    <!-- Requested constraints -->\n                    <div class=\"border rounded-lg p-4 bg-muted/30\">\n                      <h4 class=\"font-medium mb-2 text-sm\">Requested Constraints:</h4>\n                      <pre class=\"text-xs overflow-auto\">{{ currentPreset }}</pre>\n                    </div>\n\n                    <!-- Actual settings -->\n                    <div class=\"border rounded-lg p-4 bg-muted/30\">\n                      <h4 class=\"font-medium mb-2 text-sm\">Actual Settings:</h4>\n                      <div v-if=\"isActive && stream\" class=\"text-xs space-y-1 font-mono\">\n                        <p v-if=\"getActualResolution()\">\n                          Resolution: {{ getActualResolution()?.width }}x{{\n                            getActualResolution()?.height\n                          }}\n                        </p>\n                        <p v-if=\"getActualResolution()?.frameRate\">\n                          Frame Rate: {{ getActualResolution()?.frameRate?.toFixed(2) }} fps\n                        </p>\n                        <p>Tracks: {{ stream.getTracks().length }}</p>\n                        <p class=\"break-all\">Device: {{ selectedDeviceId.substring(0, 30) }}...</p>\n                      </div>\n                      <p v-else class=\"text-xs text-muted-foreground\">\n                        Start camera to see actual settings\n                      </p>\n                    </div>\n                  </div>\n\n                  <!-- Error -->\n                  <div\n                    v-if=\"error\"\n                    class=\"p-4 rounded border border-destructive bg-destructive/10 text-destructive\"\n                  >\n                    <p class=\"font-bold\">Error:</p>\n                    <p class=\"text-sm mt-1\">\n                      {{ error.message || error }}\n                      {{ (error as any).constraint ? `(${(error as any).constraint})` : '' }}\n                    </p>\n                  </div>\n                </div>\n              </template>\n            </VideoDevice>\n\n            <!-- No device selected -->\n            <div\n              v-else\n              class=\"m-4 border-2 border-dashed rounded-lg p-8 text-center text-muted-foreground\"\n            >\n              <p>Select a camera to start</p>\n            </div>\n          </div>\n\n          <!-- Provider errors - fixed at bottom -->\n          <div\n            v-if=\"errors && errors.length > 0\"\n            class=\"m-4 mt-0 p-4 rounded border border-destructive bg-destructive/10 text-destructive\"\n          >\n            <p class=\"font-bold\">Provider Errors:</p>\n            <ul class=\"text-sm space-y-1 mt-2\">\n              <li v-for=\"(error, index) in errors\" :key=\"index\">\n                {{ error.message || error }}\n                {{ (error as any).constraint ? `(${(error as any).constraint})` : '' }}\n              </li>\n            </ul>\n          </div>\n        </div>\n      </template>\n    </MediaDevicesProvider>\n  </div>\n</template>\n",
      "pug": "<script setup lang=\"ts\">\n/**\n * Demo showing VideoDevice with MediaDevicesProvider and different constraint presets.\n * Demonstrates stream caching when switching between presets on the same device.\n */\nimport { ref, computed } from 'vue';\nimport { toPascalCase } from '@assemblerjs/core';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Label } from '@/components/ui/label';\nimport {\n  MediaDevicesProvider,\n  VideoDevice,\n  VideoPresets,\n} from '@/components/ui/media-devices-provider';\n\ntype PresetName = keyof typeof VideoPresets;\n\nconst selectedPreset = ref<PresetName>('hd');\nconst selectedDeviceId = ref<string>('');\nconst videoRef = ref<HTMLVideoElement | null>(null);\nconst currentStream = ref<MediaStream | null>(null);\n\n// Detect if we're on a mobile device\nconst isMobile = computed(() => {\n  if (typeof navigator === 'undefined') return false;\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n});\n\n// Filter presets based on device type\nconst availablePresets = computed(() => {\n  const presets = { ...VideoPresets };\n  // Remove mobile presets on desktop\n  if (!isMobile.value) {\n    delete (presets as any).mobileFront;\n    delete (presets as any).mobileBack;\n  }\n  return presets;\n});\n\nconst currentPreset = computed(() => VideoPresets[selectedPreset.value]);\n\nconst handleStream = (stream: MediaStream | null) => {\n  currentStream.value = stream;\n  if (videoRef.value) {\n    videoRef.value.srcObject = stream;\n  }\n};\n\nconst selectDevice = (deviceId: string) => {\n  selectedDeviceId.value = deviceId;\n};\n\nconst getActualResolution = () => {\n  if (!videoRef.value || !currentStream.value) return null;\n  const videoTrack = currentStream.value.getVideoTracks()[0];\n  if (!videoTrack) return null;\n  const settings = videoTrack.getSettings();\n  return {\n    width: settings.width,\n    height: settings.height,\n    frameRate: settings.frameRate,\n  };\n};\n\nconst formatPresetName = (name: string): string => {\n  // List of standard preset names that should not be formatted\n  const standardNames: Record<string, string> = {\n    sd: 'SD',\n    hd: 'HD',\n    fullhd: 'Full HD',\n    '4k': '4K',\n    uhd: 'UHD',\n    uhd4k: 'UHD 4K',\n    qhd: 'QHD',\n    vga: 'VGA',\n    qvga: 'QVGA',\n  };\n\n  const lowerName = name.toLowerCase();\n\n  // Return standard name if it exists\n  if (standardNames[lowerName]) {\n    return standardNames[lowerName];\n  }\n\n  // Otherwise, convert to Pascal Case with spaces for non-standard names\n  // but ensure 'hd' is always in uppercase\n  let formatted = toPascalCase(name)\n    .replace(/([A-Z])/g, ' $1')\n    .trim();\n\n  // Replace any occurrence of 'Hd' with 'HD' (case-insensitive)\n  formatted = formatted.replace(/\\bHd\\b/gi, 'HD');\n\n  return formatted;\n};\n</script>\n\n<template lang=\"pug\">\n<!-- Top controls section -->\n<!-- Device selector -->\n<!-- Preset selector -->\n<!-- Main content area - scrollable -->\n<!-- VideoDevice with selected preset and device -->\n<!-- Video preview -->\n<!-- Resolution overlay -->\n<!-- Controls -->\n<!-- Info panels -->\n<!-- Requested constraints -->\n<!-- Actual settings -->\n<!-- Error -->\ndiv(class=\"flex flex-col\")\n  MediaDevicesProvider(:open=\"true\")\n    template(#default=\"{ devices, errors }\")\n      div(class=\"flex flex-col h-full overflow-hidden\")\n        div(class=\"p-4 space-y-4\")\n          div(class=\"space-y-2\")\n            Label(class=\"text-sm font-bold mb-4\")\n              | Available Cameras\n            div(class=\"grid gap-2\")\n              Button(v-for=\"device in devices.filter((d) =)\n                | d.kind === 'videoinput')\"\n                | :key=\"device.deviceId\"\n                | @click=\"selectDevice(device.deviceId)\"\n                | :variant=\"selectedDeviceId === device.deviceId ? 'default' : 'outline'\"\n                | size=\"sm\"\n                | class=\"justify-start\"\n                | >\n                Badge(v-if=\"selectedDeviceId === device.deviceId\" class=\"mr-2\" variant=\"secondary\")\n                  | Active\n                | {{ device.label || 'Camera' }}\n          div(class=\"space-y-2\")\n            Label(class=\"text-sm font-bold mb-4\")\n              | Video Quality\n            div(class=\"grid grid-cols-2 md:grid-cols-4 gap-2\")\n              Button(v-for=\"(preset, name) in availablePresets\" :key=\"name\" @click=\"selectedPreset = name as PresetName\" :variant=\"selectedPreset === name ? 'default' : 'outline'\" size=\"sm\")\n                | {{ formatPresetName(name as string) }}\n        div(class=\"flex-1 overflow-y-auto min-h-0\")\n          VideoDevice(v-if=\"selectedDeviceId\" :device-id=\"selectedDeviceId\" v-bind=\"currentPreset\" auto-start @stream=\"handleStream\")\n            template(#default=\"{ stream, isActive, error, start, stop }\")\n              div(class=\"p-4 space-y-4\")\n                div(class=\"relative bg-black rounded-lg overflow-hidden border border-muted\" style=\"aspect-ratio: 16/9\")\n                  video(ref=\"videoRef\" autoplay playsinline muted class=\"w-full h-full object-cover\")\n                  div(v-if=\"!isActive\" class=\"absolute inset-0 flex items-center justify-center bg-muted/50\")\n                    p(class=\"text-muted-foreground\")\n                      | Camera not started\n                  div(v-if=\"isActive\" class=\"absolute top-2 left-2 space-y-1 bg-black/70 text-white px-2 py-1 rounded text-xs font-mono\")\n                    div\n                      | {{ formatPresetName(selectedPreset) }}\n                    div(v-if=\"getActualResolution()\")\n                      | {{ getActualResolution()?.width }}x{{ getActualResolution()?.height }} @\n                      | {{ getActualResolution()?.frameRate?.toFixed(0) }}fps\n                div(class=\"flex gap-2\")\n                  Button(@click=\"start\" :disabled=\"isActive\")\n                    | Start Camera\n                  Button(@click=\"stop\" :disabled=\"!isActive\" variant=\"destructive\")\n                    | Stop Camera\n                div(class=\"grid md:grid-cols-2 gap-4\")\n                  div(class=\"border rounded-lg p-4 bg-muted/30\")\n                    h4(class=\"font-medium mb-2 text-sm\")\n                      | Requested Constraints:\n                    pre(class=\"text-xs overflow-auto\")\n                      | {{ currentPreset }}\n                  div(class=\"border rounded-lg p-4 bg-muted/30\")\n                    h4(class=\"font-medium mb-2 text-sm\")\n                      | Actual Settings:\n                    div(v-if=\"isActive && stream\" class=\"text-xs space-y-1 font-mono\")\n                      p(v-if=\"getActualResolution()\")\n                        | Resolution: {{ getActualResolution()?.width }}x{{\n                        | getActualResolution()?.height\n                        | }}\n                      p(v-if=\"getActualResolution()?.frameRate\")\n                        | Frame Rate: {{ getActualResolution()?.frameRate?.toFixed(2) }} fps\n                      p\n                        | Tracks: {{ stream.getTracks().length }}\n                      p(class=\"break-all\")\n                        | Device: {{ selectedDeviceId.substring(0, 30) }}...\n                    p(v-else class=\"text-xs text-muted-foreground\")\n                      | Start camera to see actual settings\n                div(v-if=\"error\" class=\"p-4 rounded border border-destructive bg-destructive/10 text-destructive\")\n                  p(class=\"font-bold\")\n                    | Error:\n                  p(class=\"text-sm mt-1\")\n                    | {{ error.message || error }}\n                    | {{ (error as any).constraint ? `(${(error as any).constraint})` : '' }}\n</template>\n            </VideoDevice>\n\n            <!-- No device selected -->\n            <div\n              v-else\n              class=\"m-4 border-2 border-dashed rounded-lg p-8 text-center text-muted-foreground\"\n            >\n              <p>Select a camera to start</p>\n            </div>\n          </div>\n\n          <!-- Provider errors - fixed at bottom -->\n          <div\n            v-if=\"errors && errors.length > 0\"\n            class=\"m-4 mt-0 p-4 rounded border border-destructive bg-destructive/10 text-destructive\"\n          >\n            <p class=\"font-bold\">Provider Errors:</p>\n            <ul class=\"text-sm space-y-1 mt-2\">\n              <li v-for=\"(error, index) in errors\" :key=\"index\">\n                {{ error.message || error }}\n                {{ (error as any).constraint ? `(${(error as any).constraint})` : '' }}\n              </li>\n            </ul>\n          </div>\n        </div>\n      </template>\n    </MediaDevicesProvider>\n  </div>\n</template>\n"
    },
    {
      "name": "media-device-demo-multiple",
      "definition": [
        "Multiple Viewers",
        "Open two devices simultaneously. If you select the same device for both, the provider will reuse the cached stream instead of opening it twice."
      ],
      "html": "<script setup lang=\"ts\">\n/**\n * Advanced demo showing multiple VideoDevice components using the same provider.\n * Demonstrates stream caching - opening the same device twice uses the cached stream.\n */\nimport { ref } from 'vue';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  MediaDevicesProvider,\n  VideoDevice,\n} from '@/components/ui/media-devices-provider';\n\nconst videoRef1 = ref<HTMLVideoElement | null>(null);\nconst videoRef2 = ref<HTMLVideoElement | null>(null);\nconst selectedDevice1 = ref<string>('');\nconst selectedDevice2 = ref<string>('');\n\nconst handleStream1 = (stream: MediaStream | null) => {\n  if (videoRef1.value && stream) {\n    videoRef1.value.srcObject = stream;\n  }\n};\n\nconst handleStream2 = (stream: MediaStream | null) => {\n  if (videoRef2.value && stream) {\n    videoRef2.value.srcObject = stream;\n  }\n};\n</script>\n\n<template>\n  <div class=\"space-y-6 p-6\">\n    <div>\n      <Badge variant=\"outline\" class=\"mt-4 p-2\">\n        ðŸ’¡ Try selecting the same camera for both viewers!\n      </Badge>\n    </div>\n\n    <MediaDevicesProvider :open=\"true\">\n      <template #default=\"{ devices, errors }\">\n        <div class=\"space-y-6\">\n          <div class=\"grid md:grid-cols-2 gap-6\">\n            <!-- First viewer -->\n            <div class=\"space-y-4 border rounded-lg p-4\">\n              <div class=\"flex items-center justify-between\">\n                <h4 class=\"font-medium\">Viewer 1</h4>\n                <Badge variant=\"secondary\">Camera 1</Badge>\n              </div>\n\n              <div class=\"space-y-2\">\n                <label class=\"text-xs font-medium text-muted-foreground\">Select Camera:</label>\n                <div class=\"flex flex-col gap-2\">\n                  <Button\n                    v-for=\"device in devices.filter((d) => d.kind === 'videoinput')\"\n                    :key=\"device.deviceId\"\n                    @click=\"selectedDevice1 = device.deviceId\"\n                    :variant=\"selectedDevice1 === device.deviceId ? 'default' : 'outline'\"\n                    size=\"sm\"\n                    class=\"w-full justify-start text-xs\"\n                  >\n                    <span class=\"truncate\">{{ device.label || 'Camera' }}</span>\n                  </Button>\n                </div>\n              </div>\n\n              <VideoDevice\n                v-if=\"selectedDevice1\"\n                :device-id=\"selectedDevice1\"\n                :width=\"640\"\n                :height=\"480\"\n                auto-start\n                @stream=\"handleStream1\"\n              >\n                <template #default=\"{ stream, isActive, error }\">\n                  <div class=\"space-y-2\">\n                    <div\n                      class=\"relative bg-black rounded overflow-hidden\"\n                      style=\"aspect-ratio: 4/3\"\n                    >\n                      <video\n                        ref=\"videoRef1\"\n                        autoplay\n                        playsinline\n                        muted\n                        class=\"w-full h-full object-cover\"\n                      />\n                      <div\n                        v-if=\"!isActive\"\n                        class=\"absolute inset-0 flex items-center justify-center bg-muted/50\"\n                      >\n                        <p class=\"text-xs text-muted-foreground\">Inactive</p>\n                      </div>\n                    </div>\n                    <div class=\"text-xs space-y-1\">\n                      <p>\n                        Status:\n                        <span :class=\"isActive ? 'text-green-600' : 'text-gray-500'\">\n                          {{ isActive ? 'Active' : 'Inactive' }}\n                        </span>\n                      </p>\n                      <p v-if=\"stream\" class=\"text-muted-foreground font-mono\">\n                        Tracks: {{ stream.getTracks().length }}\n                      </p>\n                    </div>\n                    <div v-if=\"error\" class=\"text-xs text-red-600 bg-red-50 p-2 rounded\">\n                      {{ error.message }}\n                    </div>\n                  </div>\n                </template>\n              </VideoDevice>\n\n              <div\n                v-else\n                class=\"border-2 border-dashed rounded p-4 text-center text-xs text-muted-foreground\"\n                style=\"aspect-ratio: 4/3\"\n              >\n                Select a camera\n              </div>\n            </div>\n\n            <!-- Second viewer -->\n            <div class=\"space-y-4 border rounded-lg p-4\">\n              <div class=\"flex items-center justify-between\">\n                <h4 class=\"font-medium\">Viewer 2</h4>\n                <Badge variant=\"secondary\">Camera 2</Badge>\n              </div>\n\n              <div class=\"space-y-2\">\n                <label class=\"text-xs font-medium text-muted-foreground\">Select Camera:</label>\n                <div class=\"flex flex-col gap-2\">\n                  <Button\n                    v-for=\"device in devices.filter((d) => d.kind === 'videoinput')\"\n                    :key=\"device.deviceId\"\n                    @click=\"selectedDevice2 = device.deviceId\"\n                    :variant=\"selectedDevice2 === device.deviceId ? 'default' : 'outline'\"\n                    size=\"sm\"\n                    class=\"w-full justify-start text-xs\"\n                  >\n                    <span class=\"truncate\">{{ device.label || 'Camera' }}</span>\n                  </Button>\n                </div>\n              </div>\n\n              <VideoDevice\n                v-if=\"selectedDevice2\"\n                :device-id=\"selectedDevice2\"\n                :width=\"640\"\n                :height=\"480\"\n                auto-start\n                @stream=\"handleStream2\"\n              >\n                <template #default=\"{ stream, isActive, error }\">\n                  <div class=\"space-y-2\">\n                    <div\n                      class=\"relative bg-black rounded overflow-hidden\"\n                      style=\"aspect-ratio: 4/3\"\n                    >\n                      <video\n                        ref=\"videoRef2\"\n                        autoplay\n                        playsinline\n                        muted\n                        class=\"w-full h-full object-cover\"\n                      />\n                      <div\n                        v-if=\"!isActive\"\n                        class=\"absolute inset-0 flex items-center justify-center bg-muted/50\"\n                      >\n                        <p class=\"text-xs text-muted-foreground\">Inactive</p>\n                      </div>\n                    </div>\n                    <div class=\"text-xs space-y-1\">\n                      <p>\n                        Status:\n                        <span :class=\"isActive ? 'text-green-600' : 'text-gray-500'\">\n                          {{ isActive ? 'Active' : 'Inactive' }}\n                        </span>\n                      </p>\n                      <p v-if=\"stream\" class=\"text-muted-foreground font-mono\">\n                        Tracks: {{ stream.getTracks().length }}\n                      </p>\n                    </div>\n                    <div v-if=\"error\" class=\"text-xs text-red-600 bg-red-50 p-2 rounded\">\n                      {{ error.message }}\n                    </div>\n                  </div>\n                </template>\n              </VideoDevice>\n\n              <div\n                v-else\n                class=\"border-2 border-dashed rounded p-4 text-center text-xs text-muted-foreground\"\n                style=\"aspect-ratio: 4/3\"\n              >\n                Select a camera\n              </div>\n            </div>\n          </div>\n\n          <!-- Info panel -->\n          <div class=\"border rounded-lg p-4 bg-muted/30\">\n            <h4 class=\"font-medium mb-2 text-sm\">Stream Caching Info</h4>\n            <div class=\"text-xs space-y-2 text-muted-foreground\">\n              <p>\n                â€¢ When both viewers use <strong>different cameras</strong>, the provider opens two\n                separate streams.\n              </p>\n              <p>\n                â€¢ When both viewers use the <strong>same camera</strong>, the provider reuses the\n                cached stream.\n              </p>\n              <p>\n                â€¢ This prevents unnecessary device access and improves performance when multiple\n                components need the same media stream.\n              </p>\n              <p v-if=\"selectedDevice1 && selectedDevice2\">\n                <Badge\n                  :variant=\"selectedDevice1 === selectedDevice2 ? 'default' : 'outline'\"\n                  class=\"mr-2\"\n                >\n                  {{\n                    selectedDevice1 === selectedDevice2\n                      ? 'âœ“ Same device - Stream cached!'\n                      : 'Different devices - 2 streams'\n                  }}\n                </Badge>\n              </p>\n            </div>\n          </div>\n\n          <!-- Provider errors -->\n          <div\n            v-if=\"errors && errors.length > 0\"\n            class=\"p-4 rounded border border-destructive bg-destructive/10 text-destructive\"\n          >\n            <p class=\"font-bold text-sm\">Provider Errors:</p>\n            <ul class=\"text-xs space-y-1 mt-2\">\n              <li v-for=\"(error, index) in errors\" :key=\"index\">{{ error.message }}</li>\n            </ul>\n          </div>\n        </div>\n      </template>\n    </MediaDevicesProvider>\n  </div>\n</template>\n",
      "pug": "<script setup lang=\"ts\">\n/**\n * Advanced demo showing multiple VideoDevice components using the same provider.\n * Demonstrates stream caching - opening the same device twice uses the cached stream.\n */\nimport { ref } from 'vue';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  MediaDevicesProvider,\n  VideoDevice,\n} from '@/components/ui/media-devices-provider';\n\nconst videoRef1 = ref<HTMLVideoElement | null>(null);\nconst videoRef2 = ref<HTMLVideoElement | null>(null);\nconst selectedDevice1 = ref<string>('');\nconst selectedDevice2 = ref<string>('');\n\nconst handleStream1 = (stream: MediaStream | null) => {\n  if (videoRef1.value && stream) {\n    videoRef1.value.srcObject = stream;\n  }\n};\n\nconst handleStream2 = (stream: MediaStream | null) => {\n  if (videoRef2.value && stream) {\n    videoRef2.value.srcObject = stream;\n  }\n};\n</script>\n\n<template lang=\"pug\">\n<!-- First viewer -->\ndiv(class=\"space-y-6 p-6\")\n  div\n    Badge(variant=\"outline\" class=\"mt-4 p-2\")\n      | ðŸ’¡ Try selecting the same camera for both viewers!\n  MediaDevicesProvider(:open=\"true\")\n    template(#default=\"{ devices, errors }\")\n      div(class=\"space-y-6\")\n        div(class=\"grid md:grid-cols-2 gap-6\")\n          div(class=\"space-y-4 border rounded-lg p-4\")\n            div(class=\"flex items-center justify-between\")\n              h4(class=\"font-medium\")\n                | Viewer 1\n              Badge(variant=\"secondary\")\n                | Camera 1\n            div(class=\"space-y-2\")\n              label(class=\"text-xs font-medium text-muted-foreground\")\n                | Select Camera:\n              div(class=\"flex flex-col gap-2\")\n                Button(v-for=\"device in devices.filter((d) =)\n                  | d.kind === 'videoinput')\"\n                  | :key=\"device.deviceId\"\n                  | @click=\"selectedDevice1 = device.deviceId\"\n                  | :variant=\"selectedDevice1 === device.deviceId ? 'default' : 'outline'\"\n                  | size=\"sm\"\n                  | class=\"w-full justify-start text-xs\"\n                  | >\n                  span(class=\"truncate\")\n                    | {{ device.label || 'Camera' }}\n            VideoDevice(v-if=\"selectedDevice1\" :device-id=\"selectedDevice1\" :width=\"640\" :height=\"480\" auto-start @stream=\"handleStream1\")\n              template(#default=\"{ stream, isActive, error }\")\n                div(class=\"space-y-2\")\n                  div(class=\"relative bg-black rounded overflow-hidden\" style=\"aspect-ratio: 4/3\")\n                    video(ref=\"videoRef1\" autoplay playsinline muted class=\"w-full h-full object-cover\")\n                    div(v-if=\"!isActive\" class=\"absolute inset-0 flex items-center justify-center bg-muted/50\")\n                      p(class=\"text-xs text-muted-foreground\")\n                        | Inactive\n                  div(class=\"text-xs space-y-1\")\n                    p\n                      | Status:\n                      span(:class=\"isActive ? 'text-green-600' : 'text-gray-500'\")\n                        | {{ isActive ? 'Active' : 'Inactive' }}\n                    p(v-if=\"stream\" class=\"text-muted-foreground font-mono\")\n                      | Tracks: {{ stream.getTracks().length }}\n                  div(v-if=\"error\" class=\"text-xs text-red-600 bg-red-50 p-2 rounded\")\n                    | {{ error.message }}\n</template>\n              </VideoDevice>\n\n              <div\n                v-else\n                class=\"border-2 border-dashed rounded p-4 text-center text-xs text-muted-foreground\"\n                style=\"aspect-ratio: 4/3\"\n              >\n                Select a camera\n              </div>\n            </div>\n\n            <!-- Second viewer -->\n            <div class=\"space-y-4 border rounded-lg p-4\">\n              <div class=\"flex items-center justify-between\">\n                <h4 class=\"font-medium\">Viewer 2</h4>\n                <Badge variant=\"secondary\">Camera 2</Badge>\n              </div>\n\n              <div class=\"space-y-2\">\n                <label class=\"text-xs font-medium text-muted-foreground\">Select Camera:</label>\n                <div class=\"flex flex-col gap-2\">\n                  <Button\n                    v-for=\"device in devices.filter((d) => d.kind === 'videoinput')\"\n                    :key=\"device.deviceId\"\n                    @click=\"selectedDevice2 = device.deviceId\"\n                    :variant=\"selectedDevice2 === device.deviceId ? 'default' : 'outline'\"\n                    size=\"sm\"\n                    class=\"w-full justify-start text-xs\"\n                  >\n                    <span class=\"truncate\">{{ device.label || 'Camera' }}</span>\n                  </Button>\n                </div>\n              </div>\n\n              <VideoDevice\n                v-if=\"selectedDevice2\"\n                :device-id=\"selectedDevice2\"\n                :width=\"640\"\n                :height=\"480\"\n                auto-start\n                @stream=\"handleStream2\"\n              >\n                <template #default=\"{ stream, isActive, error }\">\n                  <div class=\"space-y-2\">\n                    <div\n                      class=\"relative bg-black rounded overflow-hidden\"\n                      style=\"aspect-ratio: 4/3\"\n                    >\n                      <video\n                        ref=\"videoRef2\"\n                        autoplay\n                        playsinline\n                        muted\n                        class=\"w-full h-full object-cover\"\n                      />\n                      <div\n                        v-if=\"!isActive\"\n                        class=\"absolute inset-0 flex items-center justify-center bg-muted/50\"\n                      >\n                        <p class=\"text-xs text-muted-foreground\">Inactive</p>\n                      </div>\n                    </div>\n                    <div class=\"text-xs space-y-1\">\n                      <p>\n                        Status:\n                        <span :class=\"isActive ? 'text-green-600' : 'text-gray-500'\">\n                          {{ isActive ? 'Active' : 'Inactive' }}\n                        </span>\n                      </p>\n                      <p v-if=\"stream\" class=\"text-muted-foreground font-mono\">\n                        Tracks: {{ stream.getTracks().length }}\n                      </p>\n                    </div>\n                    <div v-if=\"error\" class=\"text-xs text-red-600 bg-red-50 p-2 rounded\">\n                      {{ error.message }}\n                    </div>\n                  </div>\n                </template>\n              </VideoDevice>\n\n              <div\n                v-else\n                class=\"border-2 border-dashed rounded p-4 text-center text-xs text-muted-foreground\"\n                style=\"aspect-ratio: 4/3\"\n              >\n                Select a camera\n              </div>\n            </div>\n          </div>\n\n          <!-- Info panel -->\n          <div class=\"border rounded-lg p-4 bg-muted/30\">\n            <h4 class=\"font-medium mb-2 text-sm\">Stream Caching Info</h4>\n            <div class=\"text-xs space-y-2 text-muted-foreground\">\n              <p>\n                â€¢ When both viewers use <strong>different cameras</strong>, the provider opens two\n                separate streams.\n              </p>\n              <p>\n                â€¢ When both viewers use the <strong>same camera</strong>, the provider reuses the\n                cached stream.\n              </p>\n              <p>\n                â€¢ This prevents unnecessary device access and improves performance when multiple\n                components need the same media stream.\n              </p>\n              <p v-if=\"selectedDevice1 && selectedDevice2\">\n                <Badge\n                  :variant=\"selectedDevice1 === selectedDevice2 ? 'default' : 'outline'\"\n                  class=\"mr-2\"\n                >\n                  {{\n                    selectedDevice1 === selectedDevice2\n                      ? 'âœ“ Same device - Stream cached!'\n                      : 'Different devices - 2 streams'\n                  }}\n                </Badge>\n              </p>\n            </div>\n          </div>\n\n          <!-- Provider errors -->\n          <div\n            v-if=\"errors && errors.length > 0\"\n            class=\"p-4 rounded border border-destructive bg-destructive/10 text-destructive\"\n          >\n            <p class=\"font-bold text-sm\">Provider Errors:</p>\n            <ul class=\"text-xs space-y-1 mt-2\">\n              <li v-for=\"(error, index) in errors\" :key=\"index\">{{ error.message }}</li>\n            </ul>\n          </div>\n        </div>\n      </template>\n    </MediaDevicesProvider>\n  </div>\n</template>\n"
    }
  ],
  "files": [
    {
      "name": "index",
      "title": "index",
      "path": "registry/new-york/components/media-devices-provider/index.ts",
      "description": "A renderless provider component that supplies media devices information and handles permissions.\n\nThis component uses the MediaDevices API to list available audio and video input devices.\nIt manages user permissions and provides reactive access to device information.\n\nThe demos below use different MediaDevicesProvider. In real world usage, you would typically wrap your application or a section of it with the MediaDevicesProvider component.",
      "type": "registry:ui",
      "category": "devices",
      "doc": {
        "types": [
          {
            "name": "MediaDeviceType",
            "type": "type"
          },
          {
            "name": "MediaDeviceKind",
            "type": "type"
          },
          {
            "name": "MediaPermissionState",
            "type": "type"
          },
          {
            "name": "MediaPermissions",
            "type": "interface"
          },
          {
            "name": "FilteredDevices",
            "type": "interface"
          },
          {
            "name": "CameraConstraints",
            "type": "type"
          },
          {
            "name": "MicrophoneConstraints",
            "type": "type"
          },
          {
            "name": "DeviceConstraints",
            "type": "type"
          },
          {
            "name": "MediaDeviceErrorName",
            "type": "type"
          },
          {
            "name": "MediaDeviceError",
            "type": "interface"
          },
          {
            "name": "MediaDevicesProviderSlotProps",
            "type": "interface"
          },
          {
            "name": "MediaDevicesStartFn",
            "type": "type"
          },
          {
            "name": "MediaDevicesStopFn",
            "type": "type"
          },
          {
            "name": "MediaDevicesStopAllFn",
            "type": "type"
          },
          {
            "name": "MediaDevicesIsActiveStreamFn",
            "type": "type"
          }
        ],
        "source": "/**\n * A renderless provider component that supplies media devices information and handles permissions.\n *\n * This component uses the MediaDevices API to list available audio and video input devices.\n * It manages user permissions and provides reactive access to device information.\n *\n * The demos below use different MediaDevicesProvider. In real world usage, you would typically wrap your application or a section of it with the MediaDevicesProvider component.\n *\n * @type registry:ui\n * @category devices\n * @demo MediaDevicesProviderDemoSimple\n * @demo MediaDeviceDemoSimple\n * -- Stream Cache\n * -- Select a camera from the list. The provider caches streams to avoid reopening the same device.\n * @demo MediaDeviceDemoPresets\n * -- Presets\n * -- Select a camera and quality preset. The provider caches streams efficiently when switching presets.\n * @demo MediaDeviceDemoMultiple\n * -- Multiple Viewers\n * -- Open two devices simultaneously. If you select the same device for both, the provider will reuse the cached stream instead of opening it twice.\n */\nimport type { InjectionKey, Ref } from 'vue';\n\nexport { default as MediaDevicesProvider } from './MediaDevicesProvider.vue';\nexport { default as VideoDevice } from './VideoDevice.vue';\nexport { default as AudioDevice } from './AudioDevice.vue';\n\nexport { type MediaDevicesProviderProps } from './MediaDevicesProvider.vue';\nexport { type VideoDeviceProps } from './VideoDevice.vue';\nexport { type AudioDeviceProps } from './AudioDevice.vue';\n\n/**\n * Supported media device types.\n */\nexport type MediaDeviceType = 'camera' | 'microphone' | 'all';\n\n/**\n * Media device kinds as defined by the MediaDevices API.\n */\nexport type MediaDeviceKind = 'videoinput' | 'audioinput' | 'audiooutput';\n\n/**\n * Permission states for media devices.\n */\nexport type MediaPermissionState = 'granted' | 'denied' | 'prompt' | 'unknown';\n\n/**\n * Permission status for different media types.\n */\nexport interface MediaPermissions {\n  camera: MediaPermissionState;\n  microphone: MediaPermissionState;\n}\n\n/**\n * Filtered device lists by kind.\n */\nexport interface FilteredDevices {\n  cameras: MediaDeviceInfo[];\n  microphones: MediaDeviceInfo[];\n  speakers: MediaDeviceInfo[];\n}\n\n/**\n * Constraints specifically for camera/video devices.\n * Ensures video is required when requesting camera access.\n */\nexport type CameraConstraints = MediaStreamConstraints & {\n  video: MediaTrackConstraints | boolean;\n  audio?: MediaTrackConstraints | boolean;\n};\n\n/**\n * Constraints specifically for microphone/audio devices.\n * Ensures audio is required when requesting microphone access.\n */\nexport type MicrophoneConstraints = MediaStreamConstraints & {\n  audio: MediaTrackConstraints | boolean;\n  video?: MediaTrackConstraints | boolean;\n};\n\n/**\n * Union type for all possible device-specific constraints.\n */\nexport type DeviceConstraints = CameraConstraints | MicrophoneConstraints | MediaStreamConstraints;\n\n/**\n * Specific error types for media device operations.\n */\nexport type MediaDeviceErrorName =\n  | 'NotFoundError'\n  | 'NotAllowedError'\n  | 'NotReadableError'\n  | 'OverconstrainedError'\n  | 'TypeError'\n  | 'AbortError'\n  | 'SecurityError';\n\n/**\n * Extended error interface with specific media device error information.\n */\nexport interface MediaDeviceError extends Error {\n  name: MediaDeviceErrorName;\n  constraint?: string;\n}\n\n/**\n * Slot props exposed by MediaDevicesProvider to child components.\n */\nexport interface MediaDevicesProviderSlotProps {\n  /** All available media devices */\n  devices: MediaDeviceInfo[];\n  /** Filtered list of video input devices (cameras) */\n  cameras: MediaDeviceInfo[];\n  /** Filtered list of audio input devices (microphones) */\n  microphones: MediaDeviceInfo[];\n  /** Filtered list of audio output devices (speakers) */\n  speakers: MediaDeviceInfo[];\n  /** List of errors encountered during media operations */\n  errors: Error[];\n  /** Indicates if device enumeration is in progress */\n  isLoading: boolean;\n  /** Permission states for camera and microphone */\n  permissions: MediaPermissions;\n  /** Map of active streams indexed by deviceId (readonly) */\n  activeStreams: ReadonlyMap<string, MediaStream>;\n  /** Function to start a media stream for a specific device */\n  start: MediaDevicesStartFn;\n  /** Function to stop a media stream for a specific device */\n  stop: MediaDevicesStopFn;\n  /** Function to stop all active media streams */\n  stopAll: MediaDevicesStopAllFn;\n  /** Number of currently cached/active streams */\n  cachedStreamsCount: number;\n}\n\n/**\n * Function to start a media stream with given deviceId and constraints.\n * Accepts generic MediaStreamConstraints for flexibility.\n */\nexport type MediaDevicesStartFn = (\n  deviceId: string,\n  constraints: MediaStreamConstraints\n) => Promise<MediaStream>;\n\n/**\n * Function to stop a media stream for a given deviceId.\n */\nexport type MediaDevicesStopFn = (deviceId: string) => void;\n\n/**\n * Function to stop all active media streams.\n */\nexport type MediaDevicesStopAllFn = () => void;\n\n/**\n * Function to check if a stream is active for a given deviceId.\n */\nexport type MediaDevicesIsActiveStreamFn = (deviceId: string) => boolean;\n\nexport const MediaDevicesKey: InjectionKey<Ref<MediaDeviceInfo[]>> = Symbol('MediaDevices');\nexport const MediaDevicesErrorsKey: InjectionKey<Ref<Error[]>> = Symbol('MediaDevicesErrors');\nexport const MediaDevicesLoadingKey: InjectionKey<Ref<boolean>> = Symbol('MediaDevicesLoading');\nexport const MediaDevicesPermissionsKey: InjectionKey<Ref<MediaPermissions>> =\n  Symbol('MediaDevicesPermissions');\nexport const MediaDevicesActiveStreamsKey: InjectionKey<\n  Readonly<Ref<ReadonlyMap<string, MediaStream>>>\n> = Symbol('MediaDevicesActiveStreams');\nexport const MediaDevicesStartKey: InjectionKey<MediaDevicesStartFn> = Symbol('MediaDevicesStart');\nexport const MediaDevicesStopKey: InjectionKey<MediaDevicesStopFn> = Symbol('MediaDevicesStop');\nexport const MediaDevicesStopAllKey: InjectionKey<MediaDevicesStopAllFn> =\n  Symbol('MediaDevicesStopAll');\n\n// Export presets for common use cases (work with VideoDevice and AudioDevice components)\nexport { VideoPresets, AudioPresets, MediaPresets } from './presets';\n",
        "variants": {}
      }
    },
    {
      "name": "MediaDevicesProvider",
      "title": "MediaDevicesProvider",
      "path": "registry/new-york/components/media-devices-provider/MediaDevicesProvider.vue",
      "api": "composition",
      "description": "The MediaDevicesProvider component provides a list of available media devices\n(cameras, microphones, etc.) to its child components via a scoped slot.\n ",
      "doc": {
        "path": "registry/new-york/components/media-devices-provider/MediaDevicesProvider.vue",
        "description": "The MediaDevicesProvider component provides a list of available media devices\n(cameras, microphones, etc.) to its child components via a scoped slot.\n ",
        "childComponents": [],
        "props": [
          {
            "name": "type",
            "type": "MediaDeviceType",
            "default": "all",
            "description": "The type of media devices to request."
          },
          {
            "name": "open",
            "type": "boolean",
            "default": false,
            "description": "Whether to automatically request media permissions and devices on mount."
          }
        ],
        "variants": {},
        "slots": [
          {
            "name": "default",
            "description": "Slot for child components to access media devices, errors, and stream management",
            "params": "devices, errors, is-loading, permissions, active-streams, cameras, microphones, speakers, start, stop, stop-all, cached-streams-count"
          }
        ],
        "emits": [],
        "exposes": [],
        "injects": [],
        "provides": [
          {
            "key": "MediaDevicesKey",
            "value": "devices",
            "type": "Ref<MediaDeviceInfo[]>",
            "description": "Available media devices."
          },
          {
            "key": "MediaDevicesErrorsKey",
            "value": "errors",
            "type": "Ref<Error[]>",
            "description": "Errors encountered during media operations."
          },
          {
            "key": "MediaDevicesLoadingKey",
            "value": "isLoading",
            "type": "Ref<boolean>",
            "description": "Loading state."
          },
          {
            "key": "MediaDevicesPermissionsKey",
            "value": "permissions",
            "type": "Ref<MediaPermissions>",
            "description": "Permissions state."
          },
          {
            "key": "MediaDevicesActiveStreamsKey",
            "value": "activeStreams",
            "type": "any",
            "description": "Active streams (readonly)."
          },
          {
            "key": "MediaDevicesStartKey",
            "value": "startStream",
            "type": "MediaDevicesStartFn",
            "description": "Start a media stream for a specific device."
          },
          {
            "key": "MediaDevicesStopKey",
            "value": "stopStream",
            "type": "MediaDevicesStopFn",
            "description": "Stop a media stream for a specific device."
          },
          {
            "key": "MediaDevicesStopAllKey",
            "value": "stopAllStreams",
            "type": "MediaDevicesStopAllFn",
            "description": "Stop all active media streams."
          }
        ],
        "types": [
          {
            "name": "MediaDevicesProviderProps",
            "type": "interface",
            "description": "-",
            "properties": [
              {
                "name": "type",
                "type": "MediaDeviceType",
                "description": "The type of media devices to request."
              },
              {
                "name": "open",
                "type": "boolean",
                "description": "Whether to automatically request media permissions and devices on mount."
              }
            ]
          }
        ],
        "cssVars": [],
        "source": {
          "html": "<script setup lang=\"ts\">\n/**\n * The MediaDevicesProvider component provides a list of available media devices\n * (cameras, microphones, etc.) to its child components via a scoped slot.\n */\n\nimport { provide, watch, onMounted, type Ref } from 'vue';\nimport { useMediaDevices } from '~~/registry/new-york/composables/use-media-devices/useMediaDevices';\nimport {\n  MediaDevicesKey,\n  MediaDevicesErrorsKey,\n  MediaDevicesLoadingKey,\n  MediaDevicesPermissionsKey,\n  MediaDevicesActiveStreamsKey,\n  MediaDevicesStartKey,\n  MediaDevicesStopKey,\n  MediaDevicesStopAllKey,\n  type MediaDevicesStartFn,\n  type MediaDevicesStopFn,\n  type MediaDevicesStopAllFn,\n  type MediaDeviceType,\n  type MediaPermissions,\n} from '.';\n\nexport interface MediaDevicesProviderProps {\n  /**\n   * The type of media devices to request.\n   */\n  type?: MediaDeviceType;\n  /**\n   * Whether to automatically request media permissions and devices on mount.\n   */\n  open?: boolean;\n}\n\nconst props = withDefaults(defineProps<MediaDevicesProviderProps>(), {\n  type: 'all',\n  open: false,\n});\n\nconst emit = defineEmits<{\n  streamStarted: [deviceId: string, stream: MediaStream];\n  streamStopped: [deviceId: string];\n  allStreamsStopped: [];\n  devicesUpdated: [devices: MediaDeviceInfo[]];\n  error: [error: Error];\n}>();\n\n/**\n * Use the media devices composable with event handlers.\n */\nconst {\n  devices,\n  cameras,\n  microphones,\n  speakers,\n  errors,\n  isLoading,\n  permissions,\n  activeStreams,\n  startStream,\n  stopStream,\n  stopAllStreams,\n  updateAvailableDevices,\n  ensurePermissions,\n  initialize,\n} = useMediaDevices({\n  type: props.type,\n  open: props.open,\n  onStreamStarted: (deviceId, stream) => emit('streamStarted', deviceId, stream),\n  onStreamStopped: (deviceId) => emit('streamStopped', deviceId),\n  onAllStreamsStopped: () => emit('allStreamsStopped'),\n  onDevicesUpdated: (devices) => emit('devicesUpdated', devices),\n  onError: (error) => emit('error', error),\n});\n\n/**\n * Provide media devices state and controls to child components.\n */\n\n/** Available media devices. */\nprovide<Ref<MediaDeviceInfo[]>>(MediaDevicesKey, devices);\n\n/** Errors encountered during media operations. */\nprovide<Ref<Error[]>>(MediaDevicesErrorsKey, errors);\n\n/** Loading state. */\nprovide<Ref<boolean>>(MediaDevicesLoadingKey, isLoading);\n\n/** Permissions state. */\nprovide<Ref<MediaPermissions>>(MediaDevicesPermissionsKey, permissions);\n\n/** Active streams (readonly). */\nprovide(MediaDevicesActiveStreamsKey, activeStreams);\n\n/** Start a media stream for a specific device. */\nprovide<MediaDevicesStartFn>(MediaDevicesStartKey, startStream);\n\n/** Stop a media stream for a specific device. */\nprovide<MediaDevicesStopFn>(MediaDevicesStopKey, stopStream);\n\n/** Stop all active media streams. */\nprovide<MediaDevicesStopAllFn>(MediaDevicesStopAllKey, stopAllStreams);\n\n/**\n * Watch for changes in props and update accordingly.\n */\nwatch(\n  () => [props.type, props.open] as const,\n  async ([newType, newOpen], oldValue) => {\n    const [oldType, oldOpen] = oldValue || [props.type, false];\n\n    // If open changes from false to true, request permissions and update devices\n    if (newOpen && !oldOpen) {\n      await ensurePermissions();\n      await updateAvailableDevices();\n    }\n    // If open changes from true to false, stop all active streams\n    else if (!newOpen && oldOpen) {\n      stopAllStreams();\n    }\n    // If type changes while open is true, handle stream cleanup intelligently\n    else if (newOpen && newType !== oldType) {\n      // Stop all streams only if going from 'all' to a specific type\n      // or switching between incompatible types (camera <-> microphone)\n      const shouldStopAll =\n        oldType === 'all' || // Going from 'all' to something specific\n        (oldType === 'camera' && newType === 'microphone') || // Camera to mic\n        (oldType === 'microphone' && newType === 'camera'); // Mic to camera\n\n      if (shouldStopAll) {\n        stopAllStreams();\n      }\n\n      await ensurePermissions();\n      await updateAvailableDevices();\n    }\n  }\n);\n\n/**\n * Initialize on mount.\n */\nonMounted(async () => {\n  await initialize();\n});\n</script>\n\n<template>\n  <!-- Slot for child components to access media devices, errors, and stream management -->\n  <slot\n    :devices=\"devices\"\n    :errors=\"errors\"\n    :is-loading=\"isLoading\"\n    :permissions=\"permissions\"\n    :active-streams=\"activeStreams\"\n    :cameras=\"cameras\"\n    :microphones=\"microphones\"\n    :speakers=\"speakers\"\n    :start=\"startStream\"\n    :stop=\"stopStream\"\n    :stop-all=\"stopAllStreams\"\n    :cached-streams-count=\"activeStreams.size\"\n  />\n</template>\n\n<style scoped></style>\n",
          "pug": "<script setup lang=\"ts\">\n/**\n * The MediaDevicesProvider component provides a list of available media devices\n * (cameras, microphones, etc.) to its child components via a scoped slot.\n */\n\nimport { provide, watch, onMounted, type Ref } from 'vue';\nimport { useMediaDevices } from '~~/registry/new-york/composables/use-media-devices/useMediaDevices';\nimport {\n  MediaDevicesKey,\n  MediaDevicesErrorsKey,\n  MediaDevicesLoadingKey,\n  MediaDevicesPermissionsKey,\n  MediaDevicesActiveStreamsKey,\n  MediaDevicesStartKey,\n  MediaDevicesStopKey,\n  MediaDevicesStopAllKey,\n  type MediaDevicesStartFn,\n  type MediaDevicesStopFn,\n  type MediaDevicesStopAllFn,\n  type MediaDeviceType,\n  type MediaPermissions,\n} from '.';\n\nexport interface MediaDevicesProviderProps {\n  /**\n   * The type of media devices to request.\n   */\n  type?: MediaDeviceType;\n  /**\n   * Whether to automatically request media permissions and devices on mount.\n   */\n  open?: boolean;\n}\n\nconst props = withDefaults(defineProps<MediaDevicesProviderProps>(), {\n  type: 'all',\n  open: false,\n});\n\nconst emit = defineEmits<{\n  streamStarted: [deviceId: string, stream: MediaStream];\n  streamStopped: [deviceId: string];\n  allStreamsStopped: [];\n  devicesUpdated: [devices: MediaDeviceInfo[]];\n  error: [error: Error];\n}>();\n\n/**\n * Use the media devices composable with event handlers.\n */\nconst {\n  devices,\n  cameras,\n  microphones,\n  speakers,\n  errors,\n  isLoading,\n  permissions,\n  activeStreams,\n  startStream,\n  stopStream,\n  stopAllStreams,\n  updateAvailableDevices,\n  ensurePermissions,\n  initialize,\n} = useMediaDevices({\n  type: props.type,\n  open: props.open,\n  onStreamStarted: (deviceId, stream) => emit('streamStarted', deviceId, stream),\n  onStreamStopped: (deviceId) => emit('streamStopped', deviceId),\n  onAllStreamsStopped: () => emit('allStreamsStopped'),\n  onDevicesUpdated: (devices) => emit('devicesUpdated', devices),\n  onError: (error) => emit('error', error),\n});\n\n/**\n * Provide media devices state and controls to child components.\n */\n\n/** Available media devices. */\nprovide<Ref<MediaDeviceInfo[]>>(MediaDevicesKey, devices);\n\n/** Errors encountered during media operations. */\nprovide<Ref<Error[]>>(MediaDevicesErrorsKey, errors);\n\n/** Loading state. */\nprovide<Ref<boolean>>(MediaDevicesLoadingKey, isLoading);\n\n/** Permissions state. */\nprovide<Ref<MediaPermissions>>(MediaDevicesPermissionsKey, permissions);\n\n/** Active streams (readonly). */\nprovide(MediaDevicesActiveStreamsKey, activeStreams);\n\n/** Start a media stream for a specific device. */\nprovide<MediaDevicesStartFn>(MediaDevicesStartKey, startStream);\n\n/** Stop a media stream for a specific device. */\nprovide<MediaDevicesStopFn>(MediaDevicesStopKey, stopStream);\n\n/** Stop all active media streams. */\nprovide<MediaDevicesStopAllFn>(MediaDevicesStopAllKey, stopAllStreams);\n\n/**\n * Watch for changes in props and update accordingly.\n */\nwatch(\n  () => [props.type, props.open] as const,\n  async ([newType, newOpen], oldValue) => {\n    const [oldType, oldOpen] = oldValue || [props.type, false];\n\n    // If open changes from false to true, request permissions and update devices\n    if (newOpen && !oldOpen) {\n      await ensurePermissions();\n      await updateAvailableDevices();\n    }\n    // If open changes from true to false, stop all active streams\n    else if (!newOpen && oldOpen) {\n      stopAllStreams();\n    }\n    // If type changes while open is true, handle stream cleanup intelligently\n    else if (newOpen && newType !== oldType) {\n      // Stop all streams only if going from 'all' to a specific type\n      // or switching between incompatible types (camera <-> microphone)\n      const shouldStopAll =\n        oldType === 'all' || // Going from 'all' to something specific\n        (oldType === 'camera' && newType === 'microphone') || // Camera to mic\n        (oldType === 'microphone' && newType === 'camera'); // Mic to camera\n\n      if (shouldStopAll) {\n        stopAllStreams();\n      }\n\n      await ensurePermissions();\n      await updateAvailableDevices();\n    }\n  }\n);\n\n/**\n * Initialize on mount.\n */\nonMounted(async () => {\n  await initialize();\n});\n</script>\n\n<template lang=\"pug\">\n<!-- Slot for child components to access media devices, errors, and stream management -->\nslot(:devices=\"devices\" :errors=\"errors\" :is-loading=\"isLoading\" :permissions=\"permissions\" :active-streams=\"activeStreams\" :cameras=\"cameras\" :microphones=\"microphones\" :speakers=\"speakers\" :start=\"startStream\" :stop=\"stopStream\" :stop-all=\"stopAllStreams\" :cached-streams-count=\"activeStreams.size\")\n</template>\n\n<style scoped></style>\n"
        }
      },
      "type": "registry:ui"
    },
    {
      "name": "AudioDevice",
      "title": "AudioDevice",
      "path": "registry/new-york/components/media-devices-provider/AudioDevice.vue",
      "api": "composition",
      "description": "AudioDevice component - Manages an audio stream with constraints.\nThis component builds audio constraints and uses the MediaDevicesProvider's\nstart/stop functions to manage streams with device caching.\n ",
      "doc": {
        "path": "registry/new-york/components/media-devices-provider/AudioDevice.vue",
        "description": "AudioDevice component - Manages an audio stream with constraints.\nThis component builds audio constraints and uses the MediaDevicesProvider's\nstart/stop functions to manage streams with device caching.\n ",
        "childComponents": [],
        "props": [
          {
            "name": "autoStart",
            "type": "boolean",
            "default": false,
            "description": "Whether to automatically start the media stream on mount."
          },
          {
            "name": "deviceId",
            "type": "string",
            "default": "-",
            "description": "The exact device ID to use for the audio stream (REQUIRED)."
          },
          {
            "name": "echoCancellation",
            "type": "boolean",
            "default": "-",
            "description": "Enable echo cancellation for audio input."
          },
          {
            "name": "noiseSuppression",
            "type": "boolean",
            "default": "-",
            "description": "Enable noise suppression for audio input."
          },
          {
            "name": "autoGainControl",
            "type": "boolean",
            "default": "-",
            "description": "Enable automatic gain control for audio input."
          },
          {
            "name": "sampleRate",
            "type": "number | { min?: number; max?: number; ideal?: number }",
            "default": "-",
            "description": "Audio sample rate (in Hz)."
          },
          {
            "name": "sampleSize",
            "type": "number | { min?: number; max?: number; ideal?: number }",
            "default": "-",
            "description": "Audio sample size (in bits)."
          },
          {
            "name": "constraints",
            "type": "MediaStreamConstraints",
            "default": "-",
            "description": "Custom MediaStreamConstraints to override simplified props."
          }
        ],
        "variants": {},
        "slots": [
          {
            "name": "default",
            "description": "",
            "params": "stream, is-active, is-loading, provider-is-loading, provider-permissions, provider-active-streams, error, start, stop"
          }
        ],
        "emits": [],
        "exposes": [
          {
            "name": "start",
            "description": "",
            "type": "() => void"
          },
          {
            "name": "stop",
            "description": "",
            "type": "() => void"
          },
          {
            "name": "stream",
            "description": ""
          },
          {
            "name": "isActive",
            "description": ""
          },
          {
            "name": "isLoading",
            "description": ""
          },
          {
            "name": "providerIsLoading",
            "description": ""
          },
          {
            "name": "providerPermissions",
            "description": ""
          },
          {
            "name": "providerActiveStreams",
            "description": ""
          },
          {
            "name": "error",
            "description": ""
          }
        ],
        "injects": [
          {
            "key": "MediaDevicesStartKey",
            "description": "Inject start and stop functions from MediaDevicesProvider."
          },
          {
            "key": "MediaDevicesStopKey",
            "description": ""
          },
          {
            "key": "MediaDevicesLoadingKey",
            "default": "ref(false)",
            "type": "any",
            "description": ""
          },
          {
            "key": "MediaDevicesPermissionsKey",
            "default": "ref({ camera: 'unknown', microphone: 'unknown' })",
            "type": "any",
            "description": ""
          },
          {
            "key": "MediaDevicesActiveStreamsKey",
            "default": "computed(() => new Map() as ReadonlyMap<string, MediaStream>)",
            "type": "any",
            "description": ""
          }
        ],
        "provides": [],
        "types": [
          {
            "name": "AudioDeviceProps",
            "type": "interface",
            "description": "-",
            "properties": [
              {
                "name": "autoStart",
                "type": "boolean",
                "description": "Whether to automatically start the media stream on mount."
              },
              {
                "name": "deviceId",
                "type": "string",
                "description": "The exact device ID to use for the audio stream (REQUIRED)."
              },
              {
                "name": "echoCancellation",
                "type": "boolean",
                "description": "Enable echo cancellation for audio input."
              },
              {
                "name": "noiseSuppression",
                "type": "boolean",
                "description": "Enable noise suppression for audio input."
              },
              {
                "name": "autoGainControl",
                "type": "boolean",
                "description": "Enable automatic gain control for audio input."
              },
              {
                "name": "sampleRate",
                "type": "number | { min?: number; max?: number; ideal?: number }",
                "description": "Audio sample rate (in Hz)."
              },
              {
                "name": "sampleSize",
                "type": "number | { min?: number; max?: number; ideal?: number }",
                "description": "Audio sample size (in bits)."
              },
              {
                "name": "constraints",
                "type": "MediaStreamConstraints",
                "description": "Custom MediaStreamConstraints to override simplified props."
              }
            ]
          }
        ],
        "cssVars": [],
        "source": {
          "html": "<script setup lang=\"ts\">\n/**\n * AudioDevice component - Manages an audio stream with constraints.\n * This component builds audio constraints and uses the MediaDevicesProvider's\n * start/stop functions to manage streams with device caching.\n */\n\nimport { ref, watch, onMounted, onBeforeUnmount, computed, inject, type Ref } from 'vue';\nimport {\n  MediaDevicesStartKey,\n  MediaDevicesStopKey,\n  MediaDevicesLoadingKey,\n  MediaDevicesPermissionsKey,\n  MediaDevicesActiveStreamsKey,\n  type MediaPermissions,\n} from '.';\nimport type { MediaDevicesStartFn, MediaDevicesStopFn } from '.';\n\nexport interface AudioDeviceProps {\n  /**\n   * Whether to automatically start the media stream on mount.\n   */\n  autoStart?: boolean;\n  /**\n   * The exact device ID to use for the audio stream (REQUIRED).\n   */\n  deviceId: string;\n\n  // Audio constraints\n\n  /**\n   * Enable echo cancellation for audio input.\n   */\n  echoCancellation?: boolean;\n  /**\n   * Enable noise suppression for audio input.\n   */\n  noiseSuppression?: boolean;\n  /**\n   * Enable automatic gain control for audio input.\n   */\n  autoGainControl?: boolean;\n  /**\n   * Audio sample rate (in Hz).\n   */\n  sampleRate?: number | { min?: number; max?: number; ideal?: number };\n  /**\n   * Audio sample size (in bits).\n   */\n  sampleSize?: number | { min?: number; max?: number; ideal?: number };\n\n  /**\n   * Custom MediaStreamConstraints to override simplified props.\n   */\n  constraints?: MediaStreamConstraints;\n}\n\nconst props = withDefaults(defineProps<AudioDeviceProps>(), {\n  autoStart: false,\n});\n\nconst emit = defineEmits<{\n  stream: [stream: MediaStream | null];\n  error: [error: Error];\n  started: [];\n  stopped: [];\n}>();\n\n/**\n * Inject start and stop functions from MediaDevicesProvider.\n */\nconst providerStart = inject<MediaDevicesStartFn>(MediaDevicesStartKey);\nconst providerStop = inject<MediaDevicesStopFn>(MediaDevicesStopKey);\nconst providerIsLoading = inject<Ref<boolean>>(MediaDevicesLoadingKey, ref(false));\nconst providerPermissions = inject<Ref<MediaPermissions>>(\n  MediaDevicesPermissionsKey,\n  ref({ camera: 'unknown', microphone: 'unknown' })\n);\nconst providerActiveStreams = inject<Readonly<Ref<ReadonlyMap<string, MediaStream>>>>(\n  MediaDevicesActiveStreamsKey,\n  computed(() => new Map() as ReadonlyMap<string, MediaStream>)\n);\n\nconst stream = ref<MediaStream | null>(null);\nconst error = ref<Error | null>(null);\nconst isActive = ref(false);\nconst isLoading = ref(false);\nconst currentDeviceId = ref<string | undefined>(undefined);\n\n/**\n * Build the constraints object for getUserMedia.\n */\nconst buildConstraints = (): MediaStreamConstraints => {\n  // If custom constraints are provided, use them directly\n  if (props.constraints) {\n    return props.constraints;\n  }\n\n  const audioConstraints: MediaTrackConstraints = {\n    deviceId: { exact: props.deviceId },\n    echoCancellation: props.echoCancellation,\n    noiseSuppression: props.noiseSuppression,\n    autoGainControl: props.autoGainControl,\n    sampleRate: props.sampleRate\n      ? typeof props.sampleRate === 'number'\n        ? { ideal: props.sampleRate }\n        : props.sampleRate\n      : undefined,\n    sampleSize: props.sampleSize\n      ? typeof props.sampleSize === 'number'\n        ? { ideal: props.sampleSize }\n        : props.sampleSize\n      : undefined,\n  };\n\n  return {\n    video: false,\n    audio: audioConstraints,\n  };\n};\n\n/**\n * Start the audio stream.\n */\nconst start = async () => {\n  if (typeof navigator === 'undefined' || !navigator.mediaDevices) {\n    return;\n  }\n\n  if (isActive.value || isLoading.value) {\n    return;\n  }\n\n  try {\n    isLoading.value = true;\n    error.value = null;\n    const constraints = buildConstraints();\n\n    if (providerStart) {\n      stream.value = await providerStart(props.deviceId, constraints);\n    } else {\n      stream.value = await navigator.mediaDevices.getUserMedia(constraints);\n    }\n\n    currentDeviceId.value = props.deviceId;\n    isActive.value = true;\n    emit('stream', stream.value);\n    emit('started');\n  } catch (err) {\n    const errorObj = err as Error;\n    error.value = errorObj;\n    emit('error', errorObj);\n  } finally {\n    isLoading.value = false;\n  }\n};\n\n/**\n * Stop the audio stream.\n */\nconst stop = () => {\n  if (!isActive.value) return;\n\n  const deviceIdToStop = currentDeviceId.value;\n\n  if (deviceIdToStop && providerStop) {\n    providerStop(deviceIdToStop);\n  } else if (stream.value) {\n    stream.value.getTracks().forEach((track) => track.stop());\n  }\n\n  stream.value = null;\n  isActive.value = false;\n  currentDeviceId.value = undefined;\n  emit('stream', null);\n  emit('stopped');\n};\n\n/**\n * Switch to a different device without stopping the current one (it stays in cache)\n */\nconst switchDevice = async () => {\n  const previousDeviceId = currentDeviceId.value;\n\n  // Reset state before switching\n  stream.value = null;\n  isActive.value = false;\n  currentDeviceId.value = undefined;\n\n  // Emit null stream to clear any audio elements\n  emit('stream', null);\n\n  // Start the new device\n  await start();\n};\n\n/**\n * Watch for changes to deviceId or constraints and restart the stream\n */\nwatch(\n  () => [\n    props.deviceId,\n    props.echoCancellation,\n    props.noiseSuppression,\n    props.autoGainControl,\n    props.sampleRate,\n    props.sampleSize,\n    props.constraints,\n  ],\n  async (newVals, oldVals) => {\n    const deviceIdChanged = newVals[0] !== oldVals?.[0];\n\n    if (deviceIdChanged) {\n      // If device changed, switch to the new device\n      if (isActive.value) {\n        // If currently active, switch without stopping (keeps cache)\n        await switchDevice();\n      } else if (props.autoStart) {\n        // If not active but autoStart is enabled, start the new device\n        await start();\n      }\n    } else if (isActive.value) {\n      // If only constraints changed and stream is active, restart with new constraints\n      stop();\n      await new Promise((resolve) => setTimeout(resolve, 50));\n      await start();\n    }\n  }\n);\n\nonMounted(() => {\n  if (props.autoStart) {\n    start();\n  }\n});\n\nonBeforeUnmount(() => {\n  stop();\n});\n\ndefineExpose({\n  start,\n  stop,\n  stream: computed(() => stream.value),\n  isActive: computed(() => isActive.value),\n  isLoading: computed(() => isLoading.value),\n  providerIsLoading: computed(() => providerIsLoading.value),\n  providerPermissions: computed(() => providerPermissions.value),\n  providerActiveStreams: computed(() => providerActiveStreams.value),\n  error: computed(() => error.value),\n});\n</script>\n\n<template>\n  <slot\n    :stream=\"stream\"\n    :is-active=\"isActive\"\n    :is-loading=\"isLoading\"\n    :provider-is-loading=\"providerIsLoading\"\n    :provider-permissions=\"providerPermissions\"\n    :provider-active-streams=\"providerActiveStreams\"\n    :error=\"error\"\n    :start=\"start\"\n    :stop=\"stop\"\n  />\n</template>\n\n<style scoped></style>\n",
          "pug": "<script setup lang=\"ts\">\n/**\n * AudioDevice component - Manages an audio stream with constraints.\n * This component builds audio constraints and uses the MediaDevicesProvider's\n * start/stop functions to manage streams with device caching.\n */\n\nimport { ref, watch, onMounted, onBeforeUnmount, computed, inject, type Ref } from 'vue';\nimport {\n  MediaDevicesStartKey,\n  MediaDevicesStopKey,\n  MediaDevicesLoadingKey,\n  MediaDevicesPermissionsKey,\n  MediaDevicesActiveStreamsKey,\n  type MediaPermissions,\n} from '.';\nimport type { MediaDevicesStartFn, MediaDevicesStopFn } from '.';\n\nexport interface AudioDeviceProps {\n  /**\n   * Whether to automatically start the media stream on mount.\n   */\n  autoStart?: boolean;\n  /**\n   * The exact device ID to use for the audio stream (REQUIRED).\n   */\n  deviceId: string;\n\n  // Audio constraints\n\n  /**\n   * Enable echo cancellation for audio input.\n   */\n  echoCancellation?: boolean;\n  /**\n   * Enable noise suppression for audio input.\n   */\n  noiseSuppression?: boolean;\n  /**\n   * Enable automatic gain control for audio input.\n   */\n  autoGainControl?: boolean;\n  /**\n   * Audio sample rate (in Hz).\n   */\n  sampleRate?: number | { min?: number; max?: number; ideal?: number };\n  /**\n   * Audio sample size (in bits).\n   */\n  sampleSize?: number | { min?: number; max?: number; ideal?: number };\n\n  /**\n   * Custom MediaStreamConstraints to override simplified props.\n   */\n  constraints?: MediaStreamConstraints;\n}\n\nconst props = withDefaults(defineProps<AudioDeviceProps>(), {\n  autoStart: false,\n});\n\nconst emit = defineEmits<{\n  stream: [stream: MediaStream | null];\n  error: [error: Error];\n  started: [];\n  stopped: [];\n}>();\n\n/**\n * Inject start and stop functions from MediaDevicesProvider.\n */\nconst providerStart = inject<MediaDevicesStartFn>(MediaDevicesStartKey);\nconst providerStop = inject<MediaDevicesStopFn>(MediaDevicesStopKey);\nconst providerIsLoading = inject<Ref<boolean>>(MediaDevicesLoadingKey, ref(false));\nconst providerPermissions = inject<Ref<MediaPermissions>>(\n  MediaDevicesPermissionsKey,\n  ref({ camera: 'unknown', microphone: 'unknown' })\n);\nconst providerActiveStreams = inject<Readonly<Ref<ReadonlyMap<string, MediaStream>>>>(\n  MediaDevicesActiveStreamsKey,\n  computed(() => new Map() as ReadonlyMap<string, MediaStream>)\n);\n\nconst stream = ref<MediaStream | null>(null);\nconst error = ref<Error | null>(null);\nconst isActive = ref(false);\nconst isLoading = ref(false);\nconst currentDeviceId = ref<string | undefined>(undefined);\n\n/**\n * Build the constraints object for getUserMedia.\n */\nconst buildConstraints = (): MediaStreamConstraints => {\n  // If custom constraints are provided, use them directly\n  if (props.constraints) {\n    return props.constraints;\n  }\n\n  const audioConstraints: MediaTrackConstraints = {\n    deviceId: { exact: props.deviceId },\n    echoCancellation: props.echoCancellation,\n    noiseSuppression: props.noiseSuppression,\n    autoGainControl: props.autoGainControl,\n    sampleRate: props.sampleRate\n      ? typeof props.sampleRate === 'number'\n        ? { ideal: props.sampleRate }\n        : props.sampleRate\n      : undefined,\n    sampleSize: props.sampleSize\n      ? typeof props.sampleSize === 'number'\n        ? { ideal: props.sampleSize }\n        : props.sampleSize\n      : undefined,\n  };\n\n  return {\n    video: false,\n    audio: audioConstraints,\n  };\n};\n\n/**\n * Start the audio stream.\n */\nconst start = async () => {\n  if (typeof navigator === 'undefined' || !navigator.mediaDevices) {\n    return;\n  }\n\n  if (isActive.value || isLoading.value) {\n    return;\n  }\n\n  try {\n    isLoading.value = true;\n    error.value = null;\n    const constraints = buildConstraints();\n\n    if (providerStart) {\n      stream.value = await providerStart(props.deviceId, constraints);\n    } else {\n      stream.value = await navigator.mediaDevices.getUserMedia(constraints);\n    }\n\n    currentDeviceId.value = props.deviceId;\n    isActive.value = true;\n    emit('stream', stream.value);\n    emit('started');\n  } catch (err) {\n    const errorObj = err as Error;\n    error.value = errorObj;\n    emit('error', errorObj);\n  } finally {\n    isLoading.value = false;\n  }\n};\n\n/**\n * Stop the audio stream.\n */\nconst stop = () => {\n  if (!isActive.value) return;\n\n  const deviceIdToStop = currentDeviceId.value;\n\n  if (deviceIdToStop && providerStop) {\n    providerStop(deviceIdToStop);\n  } else if (stream.value) {\n    stream.value.getTracks().forEach((track) => track.stop());\n  }\n\n  stream.value = null;\n  isActive.value = false;\n  currentDeviceId.value = undefined;\n  emit('stream', null);\n  emit('stopped');\n};\n\n/**\n * Switch to a different device without stopping the current one (it stays in cache)\n */\nconst switchDevice = async () => {\n  const previousDeviceId = currentDeviceId.value;\n\n  // Reset state before switching\n  stream.value = null;\n  isActive.value = false;\n  currentDeviceId.value = undefined;\n\n  // Emit null stream to clear any audio elements\n  emit('stream', null);\n\n  // Start the new device\n  await start();\n};\n\n/**\n * Watch for changes to deviceId or constraints and restart the stream\n */\nwatch(\n  () => [\n    props.deviceId,\n    props.echoCancellation,\n    props.noiseSuppression,\n    props.autoGainControl,\n    props.sampleRate,\n    props.sampleSize,\n    props.constraints,\n  ],\n  async (newVals, oldVals) => {\n    const deviceIdChanged = newVals[0] !== oldVals?.[0];\n\n    if (deviceIdChanged) {\n      // If device changed, switch to the new device\n      if (isActive.value) {\n        // If currently active, switch without stopping (keeps cache)\n        await switchDevice();\n      } else if (props.autoStart) {\n        // If not active but autoStart is enabled, start the new device\n        await start();\n      }\n    } else if (isActive.value) {\n      // If only constraints changed and stream is active, restart with new constraints\n      stop();\n      await new Promise((resolve) => setTimeout(resolve, 50));\n      await start();\n    }\n  }\n);\n\nonMounted(() => {\n  if (props.autoStart) {\n    start();\n  }\n});\n\nonBeforeUnmount(() => {\n  stop();\n});\n\ndefineExpose({\n  start,\n  stop,\n  stream: computed(() => stream.value),\n  isActive: computed(() => isActive.value),\n  isLoading: computed(() => isLoading.value),\n  providerIsLoading: computed(() => providerIsLoading.value),\n  providerPermissions: computed(() => providerPermissions.value),\n  providerActiveStreams: computed(() => providerActiveStreams.value),\n  error: computed(() => error.value),\n});\n</script>\n\n<template lang=\"pug\">\nslot(:stream=\"stream\" :is-active=\"isActive\" :is-loading=\"isLoading\" :provider-is-loading=\"providerIsLoading\" :provider-permissions=\"providerPermissions\" :provider-active-streams=\"providerActiveStreams\" :error=\"error\" :start=\"start\" :stop=\"stop\")\n</template>\n\n<style scoped></style>\n"
        }
      },
      "type": "registry:ui"
    },
    {
      "name": "VideoDevice",
      "title": "VideoDevice",
      "path": "registry/new-york/components/media-devices-provider/VideoDevice.vue",
      "api": "composition",
      "description": "VideoDevice component - Manages a video stream with constraints.\nThis component builds video constraints and uses the MediaDevicesProvider's\nstart/stop functions to manage streams with device caching.\n\nIMPORTANT: On iOS/Safari, you cannot use both deviceId and facingMode constraints\nsimultaneously. If both are provided, facingMode takes priority to allow the browser\nto select the appropriate camera automatically.\n ",
      "doc": {
        "path": "registry/new-york/components/media-devices-provider/VideoDevice.vue",
        "description": "VideoDevice component - Manages a video stream with constraints.\nThis component builds video constraints and uses the MediaDevicesProvider's\nstart/stop functions to manage streams with device caching.\n\nIMPORTANT: On iOS/Safari, you cannot use both deviceId and facingMode constraints\nsimultaneously. If both are provided, facingMode takes priority to allow the browser\nto select the appropriate camera automatically.\n ",
        "childComponents": [],
        "props": [
          {
            "name": "autoStart",
            "type": "boolean",
            "default": false,
            "description": "Whether to automatically start the media stream on mount."
          },
          {
            "name": "deviceId",
            "type": "string",
            "default": "-",
            "description": "The exact device ID to use for the video stream. Is optional if facingMode is provided."
          },
          {
            "name": "width",
            "type": "number | { min?: number; max?: number; ideal?: number }",
            "default": "-",
            "description": "Video resolution width (in pixels)."
          },
          {
            "name": "height",
            "type": "number | { min?: number; max?: number; ideal?: number }",
            "default": "-",
            "description": "Video resolution height (in pixels)."
          },
          {
            "name": "frameRate",
            "type": "number | { min?: number; max?: number; ideal?: number }",
            "default": "-",
            "description": "Video framerate (frames per second)."
          },
          {
            "name": "facingMode",
            "type": "'user' | 'environment' | 'left' | 'right'",
            "default": "-",
            "description": "Camera facing mode. Takes priority on deviceId."
          },
          {
            "name": "aspectRatio",
            "type": "number | { min?: number; max?: number; ideal?: number }",
            "default": "-",
            "description": "Video aspect ratio."
          },
          {
            "name": "constraints",
            "type": "MediaStreamConstraints",
            "default": "-",
            "description": "Custom MediaStreamConstraints to override simplified props."
          }
        ],
        "variants": {},
        "slots": [
          {
            "name": "default",
            "description": "",
            "params": "stream, is-active, is-loading, provider-is-loading, provider-permissions, provider-active-streams, error, start, stop"
          }
        ],
        "emits": [],
        "exposes": [
          {
            "name": "start",
            "description": "",
            "type": "() => void"
          },
          {
            "name": "stop",
            "description": "",
            "type": "() => void"
          },
          {
            "name": "stream",
            "description": ""
          },
          {
            "name": "isActive",
            "description": ""
          },
          {
            "name": "isLoading",
            "description": ""
          },
          {
            "name": "providerIsLoading",
            "description": ""
          },
          {
            "name": "providerPermissions",
            "description": ""
          },
          {
            "name": "providerActiveStreams",
            "description": ""
          },
          {
            "name": "error",
            "description": ""
          }
        ],
        "injects": [
          {
            "key": "MediaDevicesStartKey",
            "description": "Inject start and stop functions from MediaDevicesProvider."
          },
          {
            "key": "MediaDevicesStopKey",
            "description": ""
          },
          {
            "key": "MediaDevicesLoadingKey",
            "default": "ref(false)",
            "type": "any",
            "description": ""
          },
          {
            "key": "MediaDevicesPermissionsKey",
            "default": "ref({ camera: 'unknown', microphone: 'unknown' })",
            "type": "any",
            "description": ""
          },
          {
            "key": "MediaDevicesActiveStreamsKey",
            "default": "computed(() => new Map() as ReadonlyMap<string, MediaStream>)",
            "type": "any",
            "description": ""
          }
        ],
        "provides": [],
        "types": [
          {
            "name": "VideoDeviceProps",
            "type": "interface",
            "description": "-",
            "properties": [
              {
                "name": "autoStart",
                "type": "boolean",
                "description": "Whether to automatically start the media stream on mount."
              },
              {
                "name": "deviceId",
                "type": "string",
                "description": "The exact device ID to use for the video stream. Is optional if facingMode is provided."
              },
              {
                "name": "width",
                "type": "number | { min?: number; max?: number; ideal?: number }",
                "description": "Video resolution width (in pixels)."
              },
              {
                "name": "height",
                "type": "number | { min?: number; max?: number; ideal?: number }",
                "description": "Video resolution height (in pixels)."
              },
              {
                "name": "frameRate",
                "type": "number | { min?: number; max?: number; ideal?: number }",
                "description": "Video framerate (frames per second)."
              },
              {
                "name": "facingMode",
                "type": "'user' | 'environment' | 'left' | 'right'",
                "description": "Camera facing mode. Takes priority on deviceId."
              },
              {
                "name": "aspectRatio",
                "type": "number | { min?: number; max?: number; ideal?: number }",
                "description": "Video aspect ratio."
              },
              {
                "name": "constraints",
                "type": "MediaStreamConstraints",
                "description": "Custom MediaStreamConstraints to override simplified props."
              }
            ]
          }
        ],
        "cssVars": [],
        "source": {
          "html": "<script setup lang=\"ts\">\n/**\n * VideoDevice component - Manages a video stream with constraints.\n * This component builds video constraints and uses the MediaDevicesProvider's\n * start/stop functions to manage streams with device caching.\n *\n * IMPORTANT: On iOS/Safari, you cannot use both deviceId and facingMode constraints\n * simultaneously. If both are provided, facingMode takes priority to allow the browser\n * to select the appropriate camera automatically.\n */\n\nimport { ref, watch, onMounted, onBeforeUnmount, computed, inject, type Ref } from 'vue';\nimport {\n  MediaDevicesStartKey,\n  MediaDevicesStopKey,\n  MediaDevicesLoadingKey,\n  MediaDevicesPermissionsKey,\n  MediaDevicesActiveStreamsKey,\n  type MediaPermissions,\n} from '.';\nimport type { MediaDevicesStartFn, MediaDevicesStopFn } from '.';\n\nexport interface VideoDeviceProps {\n  /**\n   * Whether to automatically start the media stream on mount.\n   */\n  autoStart?: boolean;\n  /**\n   * The exact device ID to use for the video stream. Is optional if facingMode is provided.\n   */\n  deviceId?: string;\n\n  // Video constraints\n\n  /**\n   * Video resolution width (in pixels).\n   */\n  width?: number | { min?: number; max?: number; ideal?: number };\n  /**\n   * Video resolution height (in pixels).\n   */\n  height?: number | { min?: number; max?: number; ideal?: number };\n  /**\n   * Video framerate (frames per second).\n   */\n  frameRate?: number | { min?: number; max?: number; ideal?: number };\n  /**\n   * Camera facing mode. Takes priority on deviceId.\n   */\n  facingMode?: 'user' | 'environment' | 'left' | 'right';\n  /**\n   * Video aspect ratio.\n   */\n  aspectRatio?: number | { min?: number; max?: number; ideal?: number };\n\n  /**\n   * Custom MediaStreamConstraints to override simplified props.\n   */\n  constraints?: MediaStreamConstraints;\n}\n\nconst props = withDefaults(defineProps<VideoDeviceProps>(), {\n  autoStart: false,\n});\n\nconst emit = defineEmits<{\n  stream: [stream: MediaStream | null];\n  error: [error: Error];\n  started: [];\n  stopped: [];\n}>();\n\n/**\n * Inject start and stop functions from MediaDevicesProvider.\n */\nconst providerStart = inject<MediaDevicesStartFn>(MediaDevicesStartKey);\nconst providerStop = inject<MediaDevicesStopFn>(MediaDevicesStopKey);\nconst providerIsLoading = inject<Ref<boolean>>(MediaDevicesLoadingKey, ref(false));\nconst providerPermissions = inject<Ref<MediaPermissions>>(\n  MediaDevicesPermissionsKey,\n  ref({ camera: 'unknown', microphone: 'unknown' })\n);\nconst providerActiveStreams = inject<Readonly<Ref<ReadonlyMap<string, MediaStream>>>>(\n  MediaDevicesActiveStreamsKey,\n  computed(() => new Map() as ReadonlyMap<string, MediaStream>)\n);\n\nconst stream = ref<MediaStream | null>(null);\nconst error = ref<Error | null>(null);\nconst isActive = ref(false);\nconst isLoading = ref(false);\nconst currentDeviceId = ref<string | undefined>(undefined);\n\n/**\n * Build the constraints object for getUserMedia.\n */\nconst buildConstraints = (): MediaStreamConstraints => {\n  // If custom constraints are provided, use them directly\n  if (props.constraints) {\n    return props.constraints;\n  }\n\n  // Validation: at least deviceId or facingMode must be provided\n  if (!props.deviceId && !props.facingMode) {\n    throw new Error('Either deviceId or facingMode must be provided');\n  }\n\n  const videoConstraints: MediaTrackConstraints = {\n    // If facingMode is specified, use it instead of exact deviceId\n    // because on iOS you cannot use both constraints together.\n    // facingMode has priority to allow the browser to select the appropriate camera.\n    ...(props.facingMode\n      ? { facingMode: { ideal: props.facingMode } }\n      : { deviceId: { exact: props.deviceId } }),\n    width: props.width\n      ? typeof props.width === 'number'\n        ? { ideal: props.width }\n        : props.width\n      : undefined,\n    height: props.height\n      ? typeof props.height === 'number'\n        ? { ideal: props.height }\n        : props.height\n      : undefined,\n    aspectRatio: props.aspectRatio\n      ? typeof props.aspectRatio === 'number'\n        ? { ideal: props.aspectRatio }\n        : props.aspectRatio\n      : undefined,\n    frameRate: props.frameRate\n      ? typeof props.frameRate === 'number'\n        ? { ideal: props.frameRate }\n        : props.frameRate\n      : undefined,\n  };\n\n  return {\n    video: videoConstraints,\n    audio: false,\n  };\n};\n\n/**\n * Start the video stream.\n */\nconst start = async () => {\n  if (typeof navigator === 'undefined' || !navigator.mediaDevices) {\n    return;\n  }\n\n  if (isActive.value || isLoading.value) {\n    return;\n  }\n\n  try {\n    isLoading.value = true;\n    error.value = null;\n    const constraints = buildConstraints();\n\n    if (providerStart && props.deviceId && !props.facingMode) {\n      // Use provider's start function only when we have a specific deviceId\n      // and no facingMode (since facingMode lets the browser choose)\n      stream.value = await providerStart(props.deviceId, constraints);\n    } else {\n      stream.value = await navigator.mediaDevices.getUserMedia(constraints);\n    }\n\n    currentDeviceId.value = props.deviceId;\n    isActive.value = true;\n    emit('stream', stream.value);\n    emit('started');\n  } catch (err) {\n    const errorObj = err as Error;\n    error.value = errorObj;\n    emit('error', errorObj);\n  } finally {\n    isLoading.value = false;\n  }\n};\n\n/**\n * Stop the video stream.\n */\nconst stop = () => {\n  if (!isActive.value) return;\n\n  const deviceIdToStop = currentDeviceId.value;\n\n  if (deviceIdToStop && providerStop) {\n    providerStop(deviceIdToStop);\n  } else if (stream.value) {\n    stream.value.getTracks().forEach((track) => track.stop());\n  }\n\n  stream.value = null;\n  isActive.value = false;\n  currentDeviceId.value = undefined;\n  emit('stream', null);\n  emit('stopped');\n};\n\n/**\n * Switch to a different device without stopping the current one (it stays in cache)\n */\nconst switchDevice = async () => {\n  const previousDeviceId = currentDeviceId.value;\n\n  // Reset state before switching\n  stream.value = null;\n  isActive.value = false;\n  currentDeviceId.value = undefined;\n\n  // Emit null stream to clear any video elements\n  emit('stream', null);\n\n  // Start the new device\n  await start();\n};\n\n/**\n * Watch for changes to deviceId or constraints and restart the stream\n */\nwatch(\n  () => [\n    props.deviceId,\n    props.width,\n    props.height,\n    props.frameRate,\n    props.facingMode,\n    props.aspectRatio,\n    props.constraints,\n  ],\n  async (newVals, oldVals) => {\n    const deviceIdChanged = newVals[0] !== oldVals?.[0];\n\n    if (deviceIdChanged) {\n      // If device changed, switch to the new device\n      if (isActive.value) {\n        // If currently active, switch without stopping (keeps cache)\n        await switchDevice();\n      } else if (props.autoStart) {\n        // If not active but autoStart is enabled, start the new device\n        await start();\n      }\n    } else if (isActive.value) {\n      // If only constraints changed and stream is active, restart with new constraints\n      stop();\n      await new Promise((resolve) => setTimeout(resolve, 50));\n      await start();\n    }\n  }\n);\n\nonMounted(() => {\n  if (props.autoStart) {\n    start();\n  }\n});\n\nonBeforeUnmount(() => {\n  stop();\n});\n\ndefineExpose({\n  start,\n  stop,\n  stream: computed(() => stream.value),\n  isActive: computed(() => isActive.value),\n  isLoading: computed(() => isLoading.value),\n  providerIsLoading: computed(() => providerIsLoading.value),\n  providerPermissions: computed(() => providerPermissions.value),\n  providerActiveStreams: computed(() => providerActiveStreams.value),\n  error: computed(() => error.value),\n});\n</script>\n\n<template>\n  <slot\n    :stream=\"stream\"\n    :is-active=\"isActive\"\n    :is-loading=\"isLoading\"\n    :provider-is-loading=\"providerIsLoading\"\n    :provider-permissions=\"providerPermissions\"\n    :provider-active-streams=\"providerActiveStreams\"\n    :error=\"error\"\n    :start=\"start\"\n    :stop=\"stop\"\n  />\n</template>\n\n<style scoped></style>\n",
          "pug": "<script setup lang=\"ts\">\n/**\n * VideoDevice component - Manages a video stream with constraints.\n * This component builds video constraints and uses the MediaDevicesProvider's\n * start/stop functions to manage streams with device caching.\n *\n * IMPORTANT: On iOS/Safari, you cannot use both deviceId and facingMode constraints\n * simultaneously. If both are provided, facingMode takes priority to allow the browser\n * to select the appropriate camera automatically.\n */\n\nimport { ref, watch, onMounted, onBeforeUnmount, computed, inject, type Ref } from 'vue';\nimport {\n  MediaDevicesStartKey,\n  MediaDevicesStopKey,\n  MediaDevicesLoadingKey,\n  MediaDevicesPermissionsKey,\n  MediaDevicesActiveStreamsKey,\n  type MediaPermissions,\n} from '.';\nimport type { MediaDevicesStartFn, MediaDevicesStopFn } from '.';\n\nexport interface VideoDeviceProps {\n  /**\n   * Whether to automatically start the media stream on mount.\n   */\n  autoStart?: boolean;\n  /**\n   * The exact device ID to use for the video stream. Is optional if facingMode is provided.\n   */\n  deviceId?: string;\n\n  // Video constraints\n\n  /**\n   * Video resolution width (in pixels).\n   */\n  width?: number | { min?: number; max?: number; ideal?: number };\n  /**\n   * Video resolution height (in pixels).\n   */\n  height?: number | { min?: number; max?: number; ideal?: number };\n  /**\n   * Video framerate (frames per second).\n   */\n  frameRate?: number | { min?: number; max?: number; ideal?: number };\n  /**\n   * Camera facing mode. Takes priority on deviceId.\n   */\n  facingMode?: 'user' | 'environment' | 'left' | 'right';\n  /**\n   * Video aspect ratio.\n   */\n  aspectRatio?: number | { min?: number; max?: number; ideal?: number };\n\n  /**\n   * Custom MediaStreamConstraints to override simplified props.\n   */\n  constraints?: MediaStreamConstraints;\n}\n\nconst props = withDefaults(defineProps<VideoDeviceProps>(), {\n  autoStart: false,\n});\n\nconst emit = defineEmits<{\n  stream: [stream: MediaStream | null];\n  error: [error: Error];\n  started: [];\n  stopped: [];\n}>();\n\n/**\n * Inject start and stop functions from MediaDevicesProvider.\n */\nconst providerStart = inject<MediaDevicesStartFn>(MediaDevicesStartKey);\nconst providerStop = inject<MediaDevicesStopFn>(MediaDevicesStopKey);\nconst providerIsLoading = inject<Ref<boolean>>(MediaDevicesLoadingKey, ref(false));\nconst providerPermissions = inject<Ref<MediaPermissions>>(\n  MediaDevicesPermissionsKey,\n  ref({ camera: 'unknown', microphone: 'unknown' })\n);\nconst providerActiveStreams = inject<Readonly<Ref<ReadonlyMap<string, MediaStream>>>>(\n  MediaDevicesActiveStreamsKey,\n  computed(() => new Map() as ReadonlyMap<string, MediaStream>)\n);\n\nconst stream = ref<MediaStream | null>(null);\nconst error = ref<Error | null>(null);\nconst isActive = ref(false);\nconst isLoading = ref(false);\nconst currentDeviceId = ref<string | undefined>(undefined);\n\n/**\n * Build the constraints object for getUserMedia.\n */\nconst buildConstraints = (): MediaStreamConstraints => {\n  // If custom constraints are provided, use them directly\n  if (props.constraints) {\n    return props.constraints;\n  }\n\n  // Validation: at least deviceId or facingMode must be provided\n  if (!props.deviceId && !props.facingMode) {\n    throw new Error('Either deviceId or facingMode must be provided');\n  }\n\n  const videoConstraints: MediaTrackConstraints = {\n    // If facingMode is specified, use it instead of exact deviceId\n    // because on iOS you cannot use both constraints together.\n    // facingMode has priority to allow the browser to select the appropriate camera.\n    ...(props.facingMode\n      ? { facingMode: { ideal: props.facingMode } }\n      : { deviceId: { exact: props.deviceId } }),\n    width: props.width\n      ? typeof props.width === 'number'\n        ? { ideal: props.width }\n        : props.width\n      : undefined,\n    height: props.height\n      ? typeof props.height === 'number'\n        ? { ideal: props.height }\n        : props.height\n      : undefined,\n    aspectRatio: props.aspectRatio\n      ? typeof props.aspectRatio === 'number'\n        ? { ideal: props.aspectRatio }\n        : props.aspectRatio\n      : undefined,\n    frameRate: props.frameRate\n      ? typeof props.frameRate === 'number'\n        ? { ideal: props.frameRate }\n        : props.frameRate\n      : undefined,\n  };\n\n  return {\n    video: videoConstraints,\n    audio: false,\n  };\n};\n\n/**\n * Start the video stream.\n */\nconst start = async () => {\n  if (typeof navigator === 'undefined' || !navigator.mediaDevices) {\n    return;\n  }\n\n  if (isActive.value || isLoading.value) {\n    return;\n  }\n\n  try {\n    isLoading.value = true;\n    error.value = null;\n    const constraints = buildConstraints();\n\n    if (providerStart && props.deviceId && !props.facingMode) {\n      // Use provider's start function only when we have a specific deviceId\n      // and no facingMode (since facingMode lets the browser choose)\n      stream.value = await providerStart(props.deviceId, constraints);\n    } else {\n      stream.value = await navigator.mediaDevices.getUserMedia(constraints);\n    }\n\n    currentDeviceId.value = props.deviceId;\n    isActive.value = true;\n    emit('stream', stream.value);\n    emit('started');\n  } catch (err) {\n    const errorObj = err as Error;\n    error.value = errorObj;\n    emit('error', errorObj);\n  } finally {\n    isLoading.value = false;\n  }\n};\n\n/**\n * Stop the video stream.\n */\nconst stop = () => {\n  if (!isActive.value) return;\n\n  const deviceIdToStop = currentDeviceId.value;\n\n  if (deviceIdToStop && providerStop) {\n    providerStop(deviceIdToStop);\n  } else if (stream.value) {\n    stream.value.getTracks().forEach((track) => track.stop());\n  }\n\n  stream.value = null;\n  isActive.value = false;\n  currentDeviceId.value = undefined;\n  emit('stream', null);\n  emit('stopped');\n};\n\n/**\n * Switch to a different device without stopping the current one (it stays in cache)\n */\nconst switchDevice = async () => {\n  const previousDeviceId = currentDeviceId.value;\n\n  // Reset state before switching\n  stream.value = null;\n  isActive.value = false;\n  currentDeviceId.value = undefined;\n\n  // Emit null stream to clear any video elements\n  emit('stream', null);\n\n  // Start the new device\n  await start();\n};\n\n/**\n * Watch for changes to deviceId or constraints and restart the stream\n */\nwatch(\n  () => [\n    props.deviceId,\n    props.width,\n    props.height,\n    props.frameRate,\n    props.facingMode,\n    props.aspectRatio,\n    props.constraints,\n  ],\n  async (newVals, oldVals) => {\n    const deviceIdChanged = newVals[0] !== oldVals?.[0];\n\n    if (deviceIdChanged) {\n      // If device changed, switch to the new device\n      if (isActive.value) {\n        // If currently active, switch without stopping (keeps cache)\n        await switchDevice();\n      } else if (props.autoStart) {\n        // If not active but autoStart is enabled, start the new device\n        await start();\n      }\n    } else if (isActive.value) {\n      // If only constraints changed and stream is active, restart with new constraints\n      stop();\n      await new Promise((resolve) => setTimeout(resolve, 50));\n      await start();\n    }\n  }\n);\n\nonMounted(() => {\n  if (props.autoStart) {\n    start();\n  }\n});\n\nonBeforeUnmount(() => {\n  stop();\n});\n\ndefineExpose({\n  start,\n  stop,\n  stream: computed(() => stream.value),\n  isActive: computed(() => isActive.value),\n  isLoading: computed(() => isLoading.value),\n  providerIsLoading: computed(() => providerIsLoading.value),\n  providerPermissions: computed(() => providerPermissions.value),\n  providerActiveStreams: computed(() => providerActiveStreams.value),\n  error: computed(() => error.value),\n});\n</script>\n\n<template lang=\"pug\">\nslot(:stream=\"stream\" :is-active=\"isActive\" :is-loading=\"isLoading\" :provider-is-loading=\"providerIsLoading\" :provider-permissions=\"providerPermissions\" :provider-active-streams=\"providerActiveStreams\" :error=\"error\" :start=\"start\" :stop=\"stop\")\n</template>\n\n<style scoped></style>\n"
        }
      },
      "type": "registry:ui"
    },
    {
      "name": "presets",
      "title": "presets",
      "path": "registry/new-york/components/media-devices-provider/presets.ts",
      "description": "Common video resolution presets for MediaDevicesProvider\n\nUsage:\n```vue\n<MediaDevicesProvider\n  v-bind=\"VIDEO_PRESETS.HD\"\n>\n```\n ",
      "doc": {
        "types": [],
        "source": "/**\n * Common video resolution presets for MediaDevicesProvider\n *\n * Usage:\n * ```vue\n * <MediaDevicesProvider\n *   v-bind=\"VIDEO_PRESETS.HD\"\n * >\n * ```\n */\n\nexport const VideoPresets = {\n  // Standard Definition (4:3)\n  sd: {\n    width: 640,\n    height: 480,\n    frameRate: 30,\n  },\n\n  // HD (720p)\n  hd: {\n    width: 1280,\n    height: 720,\n    frameRate: 30,\n  },\n\n  // Full HD (1080p)\n  fullHd: {\n    width: 1920,\n    height: 1080,\n    frameRate: 30,\n  },\n\n  // 4K UHD\n  uhd4k: {\n    width: 3840,\n    height: 2160,\n    frameRate: 30,\n  },\n\n  // Adaptive HD (with fallbacks)\n  adaptiveHd: {\n    width: { min: 640, ideal: 1920, max: 3840 },\n    height: { min: 480, ideal: 1080, max: 2160 },\n    frameRate: { min: 24, ideal: 30, max: 60 },\n  },\n\n  // Mobile optimized (front camera)\n  mobileFront: {\n    width: { ideal: 1280 },\n    height: { ideal: 720 },\n    frameRate: { ideal: 30 },\n    facingMode: 'user' as const,\n  },\n\n  // Mobile optimized (back camera)\n  mobileBack: {\n    width: { ideal: 1920 },\n    height: { ideal: 1080 },\n    frameRate: { ideal: 30 },\n    facingMode: 'environment' as const,\n  },\n\n  // Video conferencing optimized\n  conference: {\n    width: 1280,\n    height: 720,\n    frameRate: 30,\n    aspectRatio: 1.777, // 16:9\n  },\n\n  // Screen recording optimized\n  screenRecording: {\n    width: { ideal: 1920 },\n    height: { ideal: 1080 },\n    frameRate: { ideal: 60 },\n    aspectRatio: 1.777,\n  },\n} as const;\n\n/**\n * Audio quality presets for MediaDevicesProvider\n */\nexport const AudioPresets = {\n  // Default quality with all enhancements\n  default: {\n    echoCancellation: true,\n    noiseSuppression: true,\n    autoGainControl: true,\n  },\n\n  // High quality audio (music/podcast)\n  highQuality: {\n    echoCancellation: false,\n    noiseSuppression: false,\n    autoGainControl: false,\n    sampleRate: 48000,\n  },\n\n  // Voice optimized\n  voice: {\n    echoCancellation: true,\n    noiseSuppression: true,\n    autoGainControl: true,\n    sampleRate: 48000,\n  },\n\n  // Conference call optimized\n  conference: {\n    echoCancellation: true,\n    noiseSuppression: true,\n    autoGainControl: true,\n    sampleRate: { ideal: 48000 },\n  },\n\n  // Raw audio (no processing)\n  raw: {\n    echoCancellation: false,\n    noiseSuppression: false,\n    autoGainControl: false,\n  },\n} as const;\n\n/**\n * Combined presets for common use cases\n */\nexport const MediaPresets = {\n  // Video conference\n  videoConference: {\n    ...VideoPresets.conference,\n    ...AudioPresets.conference,\n  },\n\n  // Screen recording with commentary\n  screenRecording: {\n    ...VideoPresets.screenRecording,\n    ...AudioPresets.voice,\n  },\n\n  // Podcast recording (audio only)\n  podcast: {\n    ...AudioPresets.highQuality,\n  },\n\n  // Mobile selfie video\n  mobileSelfie: {\n    ...VideoPresets.mobileFront,\n    ...AudioPresets.default,\n  },\n\n  // Mobile back camera video\n  mobileVideo: {\n    ...VideoPresets.mobileBack,\n    ...AudioPresets.default,\n  },\n} as const;\n"
      },
      "type": "registry:ui"
    }
  ]
}