{
  "$schema": "https://shadcn-vue.com/schema/registry-item.json",
  "install": "https://benoitlahoz.github.io/assembler-ui/r/use-screen-share.json",
  "name": "use-screen-share",
  "title": "useScreenShare",
  "description": "Composable for managing screen sharing functionality.\n\nThis composable provides reactive state and methods for screen sharing\nusing the getDisplayMedia API.",
  "category": "devices",
  "type": "registry:hook",
  "dependencies": {
    "dependsOn": [],
    "usedBy": [
      "screen-share-provider"
    ]
  },
  "files": [
    {
      "name": "useScreenShare",
      "title": "useScreenShare",
      "path": "registry/new-york/composables/use-screen-share/useScreenShare.ts",
      "description": "Composable for managing screen sharing functionality.\n\nThis composable provides reactive state and methods for screen sharing\nusing the getDisplayMedia API.",
      "type": "registry:hook",
      "category": {
        "name": "devices",
        "definition": [
          "Screen Sharing Hook"
        ]
      },
      "doc": {
        "path": "registry/new-york/composables/use-screen-share/useScreenShare.ts",
        "description": "Composable for managing screen sharing functionality.\n\nThis composable provides reactive state and methods for screen sharing\nusing the getDisplayMedia API.",
        "params": [
          {
            "name": "options",
            "type": "UseScreenShareOptions",
            "default": "{}",
            "description": ""
          }
        ],
        "returns": {
          "type": "{ screenStream, shareState, shareType, errors, isSharing, startScreenShare, stopScreenShare }",
          "description": "The reactive state and methods for screen sharing.",
          "properties": [
            {
              "name": "screenStream",
              "type": "Ref<MediaStream | null>",
              "description": "The stream being shared, or null if not sharing."
            },
            {
              "name": "shareState",
              "type": "Ref<ScreenShareState>",
              "description": "Current state of screen sharing."
            },
            {
              "name": "shareType",
              "type": "Ref<ScreenShareType | null>",
              "description": "Type of surface being shared (if detectable)."
            },
            {
              "name": "errors",
              "type": "Ref<Error[]>",
              "description": "List of errors encountered during screen sharing operations."
            },
            {
              "name": "isSharing",
              "type": "ComputedRef<any>",
              "description": "Whether screen sharing is currently active."
            },
            {
              "name": "startScreenShare",
              "type": "ScreenShareStartFn",
              "description": "Function to start screen sharing."
            },
            {
              "name": "stopScreenShare",
              "type": "ScreenShareStopFn",
              "description": "Function to stop screen sharing."
            }
          ]
        },
        "types": [
          {
            "name": "ScreenShareType",
            "type": "type"
          },
          {
            "name": "ScreenShareState",
            "type": "type"
          },
          {
            "name": "ScreenShareOptions",
            "type": "interface"
          },
          {
            "name": "ScreenShareStartFn",
            "type": "type"
          },
          {
            "name": "ScreenShareStopFn",
            "type": "type"
          },
          {
            "name": "UseScreenShareOptions",
            "type": "interface"
          }
        ],
        "source": "/**\n * Composable for managing screen sharing functionality.\n *\n * This composable provides reactive state and methods for screen sharing\n * using the getDisplayMedia API.\n *\n * @type registry:hook\n * @category devices\n * -- Screen Sharing Hook\n */\n\nimport { ref, computed, onBeforeUnmount } from 'vue';\n\n/**\n * Types of surfaces that can be shared.\n */\nexport type ScreenShareType = 'monitor' | 'window' | 'browser';\n\n/**\n * Current state of screen sharing.\n */\nexport type ScreenShareState = 'idle' | 'requesting' | 'active' | 'error';\n\n/**\n * Options for configuring screen sharing.\n */\nexport interface ScreenShareOptions {\n  /** Enable or configure video capture */\n  video?: boolean | MediaTrackConstraints;\n  /** Enable or configure audio capture (system audio) */\n  audio?: boolean | MediaTrackConstraints;\n  /** Prefer sharing the current browser tab (Chrome/Edge) */\n  preferCurrentTab?: boolean;\n  /** Allow user to switch shared surface without re-requesting permission */\n  surfaceSwitching?: 'include' | 'exclude';\n  /** Include or exclude the browser itself from the picker */\n  selfBrowserSurface?: 'include' | 'exclude';\n  /** Include or exclude system audio in the picker (Chrome/Edge) */\n  systemAudio?: 'include' | 'exclude';\n}\n\n/**\n * Function to start screen sharing with optional configuration.\n * Returns a Promise that resolves to the MediaStream.\n */\nexport type ScreenShareStartFn = (options?: ScreenShareOptions) => Promise<MediaStream>;\n\n/**\n * Function to stop the active screen sharing session.\n */\nexport type ScreenShareStopFn = () => void;\n\nexport interface UseScreenShareOptions {\n  /**\n   * Default options to use when starting screen share.\n   */\n  defaultOptions?: ScreenShareOptions;\n  /**\n   * Callback when screen sharing starts successfully.\n   */\n  onShareStarted?: (stream: MediaStream) => void;\n  /**\n   * Callback when screen sharing stops.\n   */\n  onShareStopped?: () => void;\n  /**\n   * Callback when an error occurs.\n   */\n  onError?: (error: Error) => void;\n}\n\nexport function useScreenShare(options: UseScreenShareOptions = {}) {\n  const { defaultOptions, onShareStarted, onShareStopped, onError } = options;\n\n  /**\n   * The active screen sharing MediaStream.\n   */\n  const screenStream = ref<MediaStream | null>(null);\n\n  /**\n   * Current state of the screen sharing session.\n   */\n  const shareState = ref<ScreenShareState>('idle');\n\n  /**\n   * Type of surface being shared (monitor, window, or browser).\n   */\n  const shareType = ref<ScreenShareType | null>(null);\n\n  /**\n   * Array of errors encountered during screen sharing operations.\n   */\n  const errors = ref<Error[]>([]);\n\n  /**\n   * Computed property indicating if screen sharing is currently active.\n   */\n  const isSharing = computed(() => shareState.value === 'active');\n\n  /**\n   * Detect the type of surface being shared from the MediaStream.\n   * This uses the getSettings() API which may not be supported in all browsers.\n   */\n  const detectShareType = (stream: MediaStream) => {\n    try {\n      const videoTrack = stream.getVideoTracks()[0];\n      if (!videoTrack) return;\n\n      const settings = videoTrack.getSettings();\n      // displaySurface is part of the Screen Capture API\n      if ('displaySurface' in settings) {\n        shareType.value = settings.displaySurface as ScreenShareType;\n      }\n    } catch (error) {\n      // getSettings may not be fully supported, ignore errors\n      console.warn('Could not detect share type:', error);\n    }\n  };\n\n  /**\n   * Handler called when the screen sharing stream ends.\n   * This can happen when the user clicks \"Stop sharing\" in the browser UI.\n   */\n  const handleStreamEnded = () => {\n    screenStream.value = null;\n    shareState.value = 'idle';\n    shareType.value = null;\n    onShareStopped?.();\n  };\n\n  /**\n   * Start a screen sharing session with the given options.\n   * If a stream is already active, returns the existing stream.\n   */\n  const startScreenShare: ScreenShareStartFn = async (options = {}) => {\n    // Return existing stream if already active\n    if (screenStream.value?.active) {\n      return screenStream.value;\n    }\n\n    // Check if we're in a browser environment\n    if (typeof navigator === 'undefined' || !navigator.mediaDevices?.getDisplayMedia) {\n      const error = new Error('getDisplayMedia not available (SSR or unsupported browser)');\n      errors.value.push(error);\n      onError?.(error);\n      throw error;\n    }\n\n    shareState.value = 'requesting';\n\n    try {\n      // Merge default options with provided options\n      const mergedOptions: ScreenShareOptions = {\n        ...defaultOptions,\n        ...options,\n      };\n\n      // Build the constraints for getDisplayMedia\n      const constraints: DisplayMediaStreamOptions = {\n        video: mergedOptions.video ?? true,\n        audio: mergedOptions.audio ?? false,\n      };\n\n      // Add Chrome/Edge specific options (they'll be ignored in other browsers)\n      if (mergedOptions.preferCurrentTab !== undefined) {\n        (constraints as any).preferCurrentTab = mergedOptions.preferCurrentTab;\n      }\n      if (mergedOptions.surfaceSwitching !== undefined) {\n        (constraints as any).surfaceSwitching = mergedOptions.surfaceSwitching;\n      }\n      if (mergedOptions.selfBrowserSurface !== undefined) {\n        (constraints as any).selfBrowserSurface = mergedOptions.selfBrowserSurface;\n      }\n      // Chrome requires systemAudio to be set to show the audio option in the picker\n      if (mergedOptions.systemAudio !== undefined) {\n        (constraints as any).systemAudio = mergedOptions.systemAudio;\n      } else if (mergedOptions.audio) {\n        // If audio is requested but systemAudio is not specified, default to 'include'\n        (constraints as any).systemAudio = 'include';\n      }\n\n      const stream = await navigator.mediaDevices.getDisplayMedia(constraints);\n\n      screenStream.value = stream;\n      shareState.value = 'active';\n\n      // Try to detect what type of surface is being shared\n      detectShareType(stream);\n\n      // Listen for when the user stops sharing via the browser UI\n      const videoTrack = stream.getVideoTracks()[0];\n      if (videoTrack) {\n        videoTrack.addEventListener('ended', handleStreamEnded);\n      }\n\n      onShareStarted?.(stream);\n      return stream;\n    } catch (error) {\n      shareState.value = 'error';\n      const err = error as Error;\n      errors.value.push(err);\n      onError?.(err);\n      throw error;\n    }\n  };\n\n  /**\n   * Stop the active screen sharing session.\n   * Stops all tracks in the stream and cleans up state.\n   */\n  const stopScreenShare: ScreenShareStopFn = () => {\n    if (screenStream.value) {\n      // Remove event listener before stopping\n      const videoTrack = screenStream.value.getVideoTracks()[0];\n      if (videoTrack) {\n        videoTrack.removeEventListener('ended', handleStreamEnded);\n      }\n\n      // Stop all tracks\n      screenStream.value.getTracks().forEach((track) => track.stop());\n      screenStream.value = null;\n      shareState.value = 'idle';\n      shareType.value = null;\n      onShareStopped?.();\n    }\n  };\n\n  /**\n   * Clean up on unmount: stop any active screen sharing.\n   */\n  onBeforeUnmount(() => {\n    stopScreenShare();\n  });\n\n  /**\n   * The reactive state and methods for screen sharing.\n   */\n  return {\n    /** The stream being shared, or null if not sharing. */\n    screenStream,\n    /** Current state of screen sharing. */\n    shareState,\n    /** Type of surface being shared (if detectable). */\n    shareType,\n    /** List of errors encountered during screen sharing operations. */\n    errors,\n    /** Whether screen sharing is currently active. */\n    isSharing,\n    /** Function to start screen sharing. */\n    startScreenShare,\n    /** Function to stop screen sharing. */\n    stopScreenShare,\n  };\n}\n"
      }
    }
  ]
}